!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=44)}([function(e,t){e.exports=React},function(e,t,n){"use strict";n.d(t,"c",function(){return c}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return h}),n.d(t,"d",function(){return m});var s="ActivityStream:Main",i="ActivityStream:Content",r="ActivityStream:PreloadedBrowser",a=1;const o="undefined"==typeof Window?2:a,c={};for(const e of["ADDONS_INFO_REQUEST","ADDONS_INFO_RESPONSE","ARCHIVE_FROM_POCKET","AS_ROUTER_TELEMETRY_USER_EVENT","BLOCK_URL","BOOKMARK_URL","COPY_DOWNLOAD_LINK","DELETE_BOOKMARK_BY_ID","DELETE_FROM_POCKET","DELETE_HISTORY_URL","DIALOG_CANCEL","DIALOG_OPEN","DISABLE_ONBOARDING","DOWNLOAD_CHANGED","INIT","MIGRATION_CANCEL","MIGRATION_COMPLETED","MIGRATION_START","NEW_TAB_INIT","NEW_TAB_INITIAL_STATE","NEW_TAB_LOAD","NEW_TAB_REHYDRATED","NEW_TAB_STATE_REQUEST","NEW_TAB_UNLOAD","OPEN_DOWNLOAD_FILE","OPEN_LINK","OPEN_NEW_WINDOW","OPEN_PRIVATE_WINDOW","OPEN_WEBEXT_SETTINGS","PAGE_PRERENDERED","PLACES_BOOKMARK_ADDED","PLACES_BOOKMARK_REMOVED","PLACES_HISTORY_CLEARED","PLACES_LINKS_CHANGED","PLACES_LINK_BLOCKED","PLACES_LINK_DELETED","PLACES_SAVED_TO_POCKET","PREFS_INITIAL_VALUES","PREF_CHANGED","PREVIEW_REQUEST","PREVIEW_REQUEST_CANCEL","PREVIEW_RESPONSE","REMOVE_DOWNLOAD_FILE","RICH_ICON_MISSING","SAVE_SESSION_PERF_DATA","SAVE_TO_POCKET","SCREENSHOT_UPDATED","SECTION_DEREGISTER","SECTION_DISABLE","SECTION_ENABLE","SECTION_MOVE","SECTION_OPTIONS_CHANGED","SECTION_REGISTER","SECTION_UPDATE","SECTION_UPDATE_CARD","SETTINGS_CLOSE","SETTINGS_OPEN","SET_PREF","SHOW_DOWNLOAD_FILE","SHOW_FIREFOX_ACCOUNTS","SKIPPED_SIGNIN","SNIPPETS_BLOCKLIST_CLEARED","SNIPPETS_BLOCKLIST_UPDATED","SNIPPETS_DATA","SNIPPETS_RESET","SNIPPET_BLOCKED","SUBMIT_EMAIL","SYSTEM_TICK","TELEMETRY_IMPRESSION_STATS","TELEMETRY_PERFORMANCE_EVENT","TELEMETRY_UNDESIRED_EVENT","TELEMETRY_USER_EVENT","THEME_UPDATE","TOP_SITES_CANCEL_EDIT","TOP_SITES_EDIT","TOP_SITES_INSERT","TOP_SITES_PIN","TOP_SITES_PREFS_UPDATED","TOP_SITES_UNPIN","TOP_SITES_UPDATED","TOTAL_BOOKMARKS_REQUEST","TOTAL_BOOKMARKS_RESPONSE","UNINIT","UPDATE_SECTION_PREFS","WEBEXT_CLICK","WEBEXT_DISMISS"])c[e]=e;const l={};for(const e of["OPEN_PRIVATE_BROWSER_WINDOW","OPEN_URL","OPEN_ABOUT_PAGE"])l[e]=e;function d(e,t){const n=e.meta?Object.assign({},e.meta):{};if(!t||!t.from||!t.to)throw new Error("Routed Messages must have options as the second parameter, and must at least include a .from and .to property.");return["from","to","toTarget","fromTarget","skipMain","skipLocal"].forEach(e=>{void 0!==t[e]?n[e]=t[e]:n[e]&&delete n[e]}),Object.assign({},e,{meta:n})}function u(e,t,n){return d(e,{from:i,to:s,fromTarget:t,skipLocal:n})}function p(e,t,n){if(!t)throw new Error("You must provide a target ID as the second parameter of AlsoToOneContent. If you want to send to all content processes, use BroadcastToContent");return d(e,{from:s,to:i,toTarget:t,skipMain:n})}var h={BroadcastToContent:function(e){return d(e,{from:s,to:i})},UserEvent:function(e){return u({type:c.TELEMETRY_USER_EVENT,data:e})},ASRouterUserEvent:function(e){return u({type:c.AS_ROUTER_TELEMETRY_USER_EVENT,data:e})},UndesiredEvent:function(e,t=o){const n={type:c.TELEMETRY_UNDESIRED_EVENT,data:e};return t===a?u(n):n},PerfEvent:function(e,t=o){const n={type:c.TELEMETRY_PERFORMANCE_EVENT,data:e};return t===a?u(n):n},ImpressionStats:function(e,t=o){const n={type:c.TELEMETRY_IMPRESSION_STATS,data:e};return t===a?u(n):n},AlsoToOneContent:p,OnlyToOneContent:function(e,t){return p(e,t,!0)},AlsoToMain:u,OnlyToMain:function(e,t){return u(e,t,!0)},AlsoToPreloaded:function(e){return d(e,{from:s,to:r})},SetPref:function(e,t,n=o){const s={type:c.SET_PREF,data:{name:e,value:t}};return n===a?u(s):s},WebExtEvent:function(e,t,n=o){if(!t||!t.source)throw new Error('WebExtEvent actions should include a property "source", the id of the webextension that should receive the event.');const s={type:e,data:t};return n===a?u(s):s}},m={isSendToMain:e=>!!e.meta&&(e.meta.to===s&&e.meta.from===i),isBroadcastToContent:e=>!!e.meta&&(e.meta.to===i&&!e.meta.toTarget),isSendToOneContent:e=>!!e.meta&&!(e.meta.to!==i||!e.meta.toTarget),isSendToPreloaded:e=>!!e.meta&&(e.meta.to===r&&e.meta.from===s),isFromMain:e=>!!e.meta&&(e.meta.from===s&&e.meta.to===i),getPortIdOfSender:e=>e.meta&&e.meta.fromTarget||null,_RouteMessage:d}},function(e,t){e.exports=ReactIntl},function(e,t){e.exports=ReactRedux},function(e,t,n){"use strict";n.d(t,"d",function(){return s}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});const s="TOP_SITES",i=["CheckPinTopSite","EditTopSite","Separator","OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl","DeleteUrl"],r=96,a=16},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return E}),n.d(t,"a",function(){return S});var s=n(1),i=n(25),r=n(21),a=n(42),o=n(10),c=n(28),l=n(0),d=n.n(l),u=n(12),p=n.n(u),h=n(8),m=n(29),_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e};const E={addListener(t){e.addMessageListener("ASRouter:parent-to-child",t)},removeListener(t){e.removeMessageListener("ASRouter:parent-to-child",t)},sendMessage(t){e.sendAsyncMessage("ASRouter:child-to-parent",t)},blockById(e){E.sendMessage({type:"BLOCK_MESSAGE_BY_ID",data:{id:e}})},blockBundle(e){E.sendMessage({type:"BLOCK_BUNDLE",data:{bundle:e}})},executeAction({button_action:e,button_action_params:t}){e in s.a&&E.sendMessage({type:e,data:{button_action_params:t}})},unblockById(e){E.sendMessage({type:"UNBLOCK_MESSAGE_BY_ID",data:{id:e}})},unblockBundle(e){E.sendMessage({type:"UNBLOCK_BUNDLE",data:{bundle:e}})},getNextMessage(){E.sendMessage({type:"GET_NEXT_MESSAGE"})},overrideMessage(e){E.sendMessage({type:"OVERRIDE_MESSAGE",data:{id:e}})},sendTelemetry(t){const n=s.b.ASRouterUserEvent(t);e.sendAsyncMessage(r.a,n)}};function f(e,t){return e.message.id&&(!t.message||t.message.id!==e.message.id)}const g={b:d.a.createElement("b",null),i:d.a.createElement("i",null),u:d.a.createElement("u",null),strong:d.a.createElement("strong",null),em:d.a.createElement("em",null),br:d.a.createElement("br",null)};function b(e){return d.a.createElement(i.b,_({id:"RichTextSnippet"},g,function(e,t){return e?Object.keys(e).reduce((n,s)=>(n[s]=d.a.createElement("a",{href:Object(h.a)(e[s].url),"data-metric":e[s].metric,onClick:t}),n),{}):null}(e.links,e.sendClick)),d.a.createElement("span",null,e.text))}class v extends d.a.PureComponent{constructor(e){super(e),this.onMessageFromParent=this.onMessageFromParent.bind(this),this.sendClick=this.sendClick.bind(this),this.sendImpression=this.sendImpression.bind(this),this.sendUserActionTelemetry=this.sendUserActionTelemetry.bind(this),this.state={message:{},bundle:{}}}sendUserActionTelemetry(e={}){const{message:t,bundle:n}=this.state;if(!t&&!e.message_id)throw new Error("You must provide a message_id for bundled messages");const s=`${t.provider||n.provider}_user_event`;E.sendTelemetry(Object.assign({message_id:t.id||e.message_id,source:e.id,action:s},e))}sendImpression(e){this.sendUserActionTelemetry(Object.assign({event:"IMPRESSION"},e))}sendClick(e){const t={value:e.target.dataset.metric,id:"NEWTAB_FOOTER_BAR_CONTENT"};this.sendUserActionTelemetry(Object.assign({event:"CLICK_BUTTON"},t))}onBlockById(e){return()=>E.blockById(e)}clearBundle(e){return()=>E.blockBundle(e)}onMessageFromParent({data:e}){switch(e.type){case"SET_MESSAGE":this.setState({message:e.data});break;case"SET_BUNDLED_MESSAGES":this.setState({bundle:e.data});break;case"CLEAR_MESSAGE":e.data.id===this.state.message.id&&this.setState({message:{}});break;case"CLEAR_BUNDLE":this.state.bundle.bundle&&this.setState({bundle:{}});break;case"CLEAR_ALL":this.setState({message:{},bundle:{}})}}componentWillMount(){E.addListener(this.onMessageFromParent),"about:welcome"===this.props.document.location.href?E.sendMessage({type:"TRIGGER",data:{trigger:"firstRun"}}):E.sendMessage({type:"CONNECT_UI_REQUEST"})}componentWillUnmount(){E.removeListener(this.onMessageFromParent)}renderSnippets(){return d.a.createElement(a.a,{id:"NEWTAB_FOOTER_BAR",message:this.state.message,sendImpression:this.sendImpression,shouldSendImpressionOnUpdate:f,document:this.props.document},d.a.createElement(i.a,{messages:function(e){const t=new o.b("en-US");return t.addMessages(`RichTextSnippet = ${e}`),[t]}(this.state.message.content.text)},d.a.createElement(m.a,_({},this.state.message,{richText:d.a.createElement(b,{text:this.state.message.content.text,links:this.state.message.content.links,sendClick:this.sendClick}),UISurface:"NEWTAB_FOOTER_BAR",getNextMessage:E.getNextMessage,onBlock:this.onBlockById(this.state.message.id),sendUserActionTelemetry:this.sendUserActionTelemetry}))))}renderOnboarding(){return d.a.createElement(c.a,_({},this.state.bundle,{UISurface:"NEWTAB_OVERLAY",onAction:E.executeAction,onDoneButton:this.clearBundle(this.state.bundle.bundle),getNextMessage:E.getNextMessage,sendUserActionTelemetry:this.sendUserActionTelemetry}))}render(){const{message:e,bundle:t}=this.state;return e.id||t.template?"onboarding"===t.template?this.renderOnboarding():this.renderSnippets():null}}v.defaultProps={document:e.document};class S{constructor(){this.initialized=!1,this.containerElement=null}_mount(){this.containerElement=e.document.getElementById("snippets-container"),p.a.render(d.a.createElement(v,null),this.containerElement)}_unmount(){p.a.unmountComponentAtNode(this.containerElement)}init(){this._mount(),this.initialized=!0}uninit(){this.initialized&&(this._unmount(),this.initialized=!1)}}}).call(this,n(5))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});const s={isBlob:(e,t)=>!!(t&&t.path&&(!e&&t.data||e&&t.url)),createLocalImageObject(t){return t?this.isBlob(!1,t)?{url:e.URL.createObjectURL(t.data),path:t.path}:{url:t}:null},maybeRevokeBlobObjectURL(t){this.isBlob(!0,t)&&e.URL.revokeObjectURL(t.url)},isRemoteImageLocal(e,t){return t&&e?this.isBlob(!1,t)?e.path===t.path:e.url===t:!t&&!e}}}).call(this,n(5))},function(e,t,n){"use strict";function s(e){if(!e)return"";const{protocol:t}=new URL(e),n=["http:","https:","data:","resource:","chrome:"].includes(t);return n||console.warn(`The protocol ${t} is not allowed for template URLs.`),n?e:""}n.d(t,"a",function(){return s})},function(e,t,n){"use strict";var s=n(1);n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});const i=8,r=new class{constructor(e){this.createKey=e||this.defaultCreateKey}defaultCreateKey(e){return e}group(...e){const t=new Set,n=[];for(const s of e){const e=new Map;for(const n of s){const s=this.createKey(n);t.has(s)||e.has(s)||e.set(s,n)}n.push(e),e.forEach((e,n)=>t.add(n))}return n.map(e=>Array.from(e.values()))}}(e=>e&&e.url),a={App:{initialized:!1,version:null},Snippets:{initialized:!1},TopSites:{initialized:!1,rows:[],editForm:null},Prefs:{initialized:!1,values:{}},Theme:{className:""},Dialog:{visible:!1,data:{}},Sections:[]};var o={TopSites:function(e=a.TopSites,t){let n,i;switch(t.type){case s.c.TOP_SITES_UPDATED:return t.data&&t.data.links?Object.assign({},e,{initialized:!0,rows:t.data.links},t.data.pref?{pref:t.data.pref}:{}):e;case s.c.TOP_SITES_PREFS_UPDATED:return Object.assign({},e,{pref:t.data.pref});case s.c.TOP_SITES_EDIT:return Object.assign({},e,{editForm:{index:t.data.index,previewResponse:null}});case s.c.TOP_SITES_CANCEL_EDIT:return Object.assign({},e,{editForm:null});case s.c.PREVIEW_RESPONSE:return e.editForm&&t.data.url===e.editForm.previewUrl?Object.assign({},e,{editForm:{index:e.editForm.index,previewResponse:t.data.preview,previewUrl:t.data.url}}):e;case s.c.PREVIEW_REQUEST:return e.editForm?Object.assign({},e,{editForm:{index:e.editForm.index,previewResponse:null,previewUrl:t.data.url}}):e;case s.c.PREVIEW_REQUEST_CANCEL:return e.editForm?Object.assign({},e,{editForm:{index:e.editForm.index,previewResponse:null}}):e;case s.c.SCREENSHOT_UPDATED:return i=e.rows.map(e=>e&&e.url===t.data.url?(n=!0,Object.assign({},e,{screenshot:t.data.screenshot})):e),n?Object.assign({},e,{rows:i}):e;case s.c.PLACES_BOOKMARK_ADDED:return t.data?(i=e.rows.map(e=>{if(e&&e.url===t.data.url){const{bookmarkGuid:n,bookmarkTitle:s,dateAdded:i}=t.data;return Object.assign({},e,{bookmarkGuid:n,bookmarkTitle:s,bookmarkDateCreated:i})}return e}),Object.assign({},e,{rows:i})):e;case s.c.PLACES_BOOKMARK_REMOVED:return t.data?(i=e.rows.map(e=>{if(e&&e.url===t.data.url){const t=Object.assign({},e);return delete t.bookmarkGuid,delete t.bookmarkTitle,delete t.bookmarkDateCreated,t}return e}),Object.assign({},e,{rows:i})):e;case s.c.PLACES_LINK_DELETED:return t.data?(i=e.rows.filter(e=>t.data.url!==e.url),Object.assign({},e,{rows:i})):e;default:return e}},App:function(e=a.App,t){switch(t.type){case s.c.INIT:return Object.assign({},e,t.data||{},{initialized:!0});default:return e}},Snippets:function(e=a.Snippets,t){switch(t.type){case s.c.SNIPPETS_DATA:return Object.assign({},e,{initialized:!0},t.data);case s.c.SNIPPET_BLOCKED:return Object.assign({},e,{blockList:e.blockList.concat(t.data)});case s.c.SNIPPETS_BLOCKLIST_CLEARED:return Object.assign({},e,{blockList:[]});case s.c.SNIPPETS_RESET:return a.Snippets;default:return e}},Prefs:function(e=a.Prefs,t){let n;switch(t.type){case s.c.PREFS_INITIAL_VALUES:return Object.assign({},e,{initialized:!0,values:t.data});case s.c.PREF_CHANGED:return(n=Object.assign({},e.values))[t.data.name]=t.data.value,Object.assign({},e,{values:n});default:return e}},Dialog:function(e=a.Dialog,t){switch(t.type){case s.c.DIALOG_OPEN:return Object.assign({},e,{visible:!0,data:t.data});case s.c.DIALOG_CANCEL:return Object.assign({},e,{visible:!1});case s.c.DELETE_HISTORY_URL:return Object.assign({},a.Dialog);default:return e}},Sections:function(e=a.Sections,t){let n,i;switch(t.type){case s.c.SECTION_DEREGISTER:return e.filter(e=>e.id!==t.data);case s.c.SECTION_REGISTER:if(i=e.map(e=>e&&e.id===t.data.id?(n=!0,Object.assign({},e,t.data)):e),!n){const e=!!(t.data.rows&&t.data.rows.length>0),n=Object.assign({title:"",rows:[],enabled:!1},t.data,{initialized:e});i.push(n)}return i;case s.c.SECTION_UPDATE:return i=e.map(e=>{if(e&&e.id===t.data.id){const n=t.data.rows?{initialized:!0}:{};if(t.data.rows&&t.data.rows.length>0&&e.rows.find(e=>e.pinned)){const s=Array.from(t.data.rows);return e.rows.forEach((e,t)=>{e.pinned&&s.splice(t,0,e)}),Object.assign({},e,n,Object.assign({},t.data,{rows:s}))}return Object.assign({},e,n,t.data)}return e}),t.data.dedupeConfigurations?(t.data.dedupeConfigurations.forEach(e=>{i=i.map(t=>{if(t.id===e.id){const n=e.dedupeFrom.reduce((e,t)=>{const n=i.find(e=>e.id===t),[,s]=r.group(n.rows,e);return s},t.rows);return Object.assign({},t,{rows:n})}return t})}),i):i;case s.c.SECTION_UPDATE_CARD:return e.map(e=>{if(e&&e.id===t.data.id&&e.rows){const n=e.rows.map(e=>e.url===t.data.url?Object.assign({},e,t.data.options):e);return Object.assign({},e,{rows:n})}return e});case s.c.PLACES_BOOKMARK_ADDED:return t.data?e.map(e=>Object.assign({},e,{rows:e.rows.map(e=>{if(e.url===t.data.url){const{bookmarkGuid:n,bookmarkTitle:s,dateAdded:i}=t.data;return Object.assign({},e,{bookmarkGuid:n,bookmarkTitle:s,bookmarkDateCreated:i,type:"bookmark"})}return e})})):e;case s.c.PLACES_SAVED_TO_POCKET:return t.data?e.map(e=>Object.assign({},e,{rows:e.rows.map(e=>e.url===t.data.url?Object.assign({},e,{open_url:t.data.open_url,pocket_id:t.data.pocket_id,title:t.data.title,type:"pocket"}):e)})):e;case s.c.PLACES_BOOKMARK_REMOVED:return t.data?e.map(e=>Object.assign({},e,{rows:e.rows.map(e=>{if(e.url===t.data.url){const t=Object.assign({},e);return delete t.bookmarkGuid,delete t.bookmarkTitle,delete t.bookmarkDateCreated,t.type&&"bookmark"!==t.type||(t.type="history"),t}return e})})):e;case s.c.PLACES_LINK_DELETED:case s.c.PLACES_LINK_BLOCKED:return t.data?e.map(e=>Object.assign({},e,{rows:e.rows.filter(e=>e.url!==t.data.url)})):e;case s.c.DELETE_FROM_POCKET:case s.c.ARCHIVE_FROM_POCKET:return e.map(e=>Object.assign({},e,{rows:e.rows.filter(e=>e.pocket_id!==t.data.pocket_id)}));default:return e}},Theme:function(e=a.Theme,t){switch(t.type){case s.c.THEME_UPDATE:return Object.assign({},e,t.data);default:return e}}}},function(e,t,n){"use strict";const s=100,i=/-?[a-zA-Z][a-zA-Z0-9_-]*/y,r=/[a-zA-Z][a-zA-Z0-9_-]*/y,a=/^[A-Z][A-Z_?-]*$/;class o{getResource(e){this._source=e,this._index=0,this._length=e.length,this.entries={};const t=[];for(this.skipWS();this._index<this._length;){try{this.getEntry()}catch(e){if(!(e instanceof SyntaxError))throw e;t.push(e),this.skipToNextEntryStart()}this.skipWS()}return[this.entries,t]}getEntry(){if(0!==this._index&&"\n"!==this._source[this._index-1])throw this.error("Expected an entry to start\n        at the beginning of the file or on a new line.");const e=this._source[this._index];"/"===e||"#"===e&&[" ","#","\n"].includes(this._source[this._index+1])?this.skipComment():"["!==e?this.getMessage():this.skipSection()}skipSection(){if(this._index+=1,"["!==this._source[this._index])throw this.error('Expected "[[" to open a section');if(this._index+=1,this.skipInlineWS(),this.getVariantName(),this.skipInlineWS(),"]"!==this._source[this._index]||"]"!==this._source[this._index+1])throw this.error('Expected "]]" to close a section');this._index+=2}getMessage(){const e=this.getEntryIdentifier();this.skipInlineWS(),"="===this._source[this._index]&&this._index++,this.skipInlineWS();const t=this.getPattern();if(e.startsWith("-")&&null===t)throw this.error("Expected term to have a value");let n=null;if(" "===this._source[this._index]){const e=this._index;this.skipInlineWS(),"."===this._source[this._index]&&(this._index=e,n=this.getAttributes())}if(null===n&&"string"==typeof t)this.entries[e]=t;else{if(null===t&&null===n)throw this.error("Expected message to have a value or attributes");this.entries[e]={},null!==t&&(this.entries[e].val=t),null!==n&&(this.entries[e].attrs=n)}}skipWS(){let e=this._source[this._index];for(;" "===e||"\n"===e||"\t"===e||"\r"===e;)e=this._source[++this._index]}skipInlineWS(){let e=this._source[this._index];for(;" "===e||"\t"===e;)e=this._source[++this._index]}skipBlankLines(){for(;;){const e=this._index;if(this.skipInlineWS(),"\n"!==this._source[this._index]){this._index=e;break}this._index+=1}}getIdentifier(e=r){e.lastIndex=this._index;const t=e.exec(this._source);if(null===t)throw this._index+=1,this.error(`Expected an identifier [${e.toString()}]`);return this._index=e.lastIndex,t[0]}getEntryIdentifier(){return this.getIdentifier(i)}getVariantName(){let e="";const t=this._index;let n=this._source.charCodeAt(this._index);if(!(n>=97&&n<=122||n>=65&&n<=90||95===n||32===n))throw this.error("Expected a keyword (starting with [a-zA-Z_])");for(n=this._source.charCodeAt(++this._index);n>=97&&n<=122||n>=65&&n<=90||n>=48&&n<=57||95===n||45===n||32===n;)n=this._source.charCodeAt(++this._index);for(;32===this._source.charCodeAt(this._index-1);)this._index--;return{type:"varname",name:e+=this._source.slice(t,this._index)}}getString(){const e=this._index+1;for(;++this._index<this._length;){const e=this._source[this._index];if('"'===e)break;if("\n"===e)throw this.error("Unterminated string expression")}return this._source.substring(e,this._index++)}getPattern(){const e=this._index;let t=this._source.indexOf("\n",this._index);-1===t&&(t=this._length);const n=e!==t?this._source.slice(e,t):null;if(n&&n.includes("{"))return this.getComplexPattern();if(this._index=t+1,this.skipBlankLines()," "!==this._source[this._index])return n;const s=this._index;return this.skipInlineWS(),"."===this._source[this._index]?(this._index=s,n):(n&&(this._index=e),this.getComplexPattern())}getComplexPattern(){let e="";const t=[];let n=0,i=this._source[this._index];for(;this._index<this._length;)if("\n"!==i){if("\\"===i){const e=this._source[this._index+1];'"'!==e&&"{"!==e&&"\\"!==e||(i=e,this._index++)}else if("{"===i){if(e.length&&t.push(e),n>s-1)throw this.error(`Too many placeables, maximum allowed is ${s}`);e="",t.push(this.getPlaceable()),this._index++,i=this._source[this._index],n++;continue}i&&(e+=i),this._index++,i=this._source[this._index]}else{this._index++;const n=this._index;this.skipBlankLines();const s=this._index;if(" "!==this._source[this._index])break;if(this.skipInlineWS(),"}"===this._source[this._index]||"["===this._source[this._index]||"*"===this._source[this._index]||"."===this._source[this._index]){this._index=s;break}((e+=this._source.substring(n,s)).length||t.length)&&(e+="\n"),i=this._source[this._index]}return 0===t.length?e.length?e:null:(e.length&&t.push(e),t)}getPlaceable(){const e=++this._index;if(this.skipWS(),"*"===this._source[this._index]||"["===this._source[this._index]&&"]"!==this._source[this._index+1]){const e=this.getVariants();return{type:"sel",exp:null,vars:e[0],def:e[1]}}this._index=e,this.skipInlineWS();const t=this.getSelectorExpression();this.skipWS();const n=this._source[this._index];if("}"===n){if("attr"===t.type&&t.id.name.startsWith("-"))throw this.error("Attributes of private messages cannot be interpolated.");return t}if("-"!==n||">"!==this._source[this._index+1])throw this.error('Expected "}" or "->"');if("ref"===t.type)throw this.error("Message references cannot be used as selectors.");if("var"===t.type)throw this.error("Variants cannot be used as selectors.");if("attr"===t.type&&!t.id.name.startsWith("-"))throw this.error("Attributes of public messages cannot be used as selectors.");if(this._index+=2,this.skipInlineWS(),"\n"!==this._source[this._index])throw this.error("Variants should be listed in a new line");this.skipWS();const s=this.getVariants();if(0===s[0].length)throw this.error("Expected members for the select expression");return{type:"sel",exp:t,vars:s[0],def:s[1]}}getSelectorExpression(){const e=this.getLiteral();if("ref"!==e.type)return e;if("."===this._source[this._index]){this._index++;const t=this.getIdentifier();return this._index++,{type:"attr",id:e,name:t}}if("["===this._source[this._index]){this._index++;const t=this.getVariantKey();return this._index++,{type:"var",id:e,key:t}}if("("===this._source[this._index]){this._index++;const t=this.getCallArgs();if(!a.test(e.name))throw this.error("Function names must be all upper-case");return this._index++,e.type="fun",{type:"call",fun:e,args:t}}return e}getCallArgs(){const e=[];for(;this._index<this._length;){if(this.skipInlineWS(),")"===this._source[this._index])return e;const t=this.getSelectorExpression();if("ref"!==t.type)e.push(t);else if(this.skipInlineWS(),":"===this._source[this._index]){this._index++,this.skipInlineWS();const n=this.getSelectorExpression();if("string"!=typeof n&&!Array.isArray(n)&&"num"!==n.type)throw this._index=this._source.lastIndexOf(":",this._index)+1,this.error("Expected string in quotes, number.");e.push({type:"narg",name:t.name,val:n})}else e.push(t);if(this.skipInlineWS(),")"===this._source[this._index])break;if(","!==this._source[this._index])throw this.error('Expected "," or ")"');this._index++}return e}getNumber(){let e="",t=this._source.charCodeAt(this._index);if(45===t&&(e+="-",t=this._source.charCodeAt(++this._index)),t<48||t>57)throw this.error(`Unknown literal "${e}"`);for(;t>=48&&t<=57;)e+=this._source[this._index++],t=this._source.charCodeAt(this._index);if(46===t){if(e+=this._source[this._index++],(t=this._source.charCodeAt(this._index))<48||t>57)throw this.error(`Unknown literal "${e}"`);for(;t>=48&&t<=57;)e+=this._source[this._index++],t=this._source.charCodeAt(this._index)}return{type:"num",val:e}}getAttributes(){const e={};for(;this._index<this._length&&" "===this._source[this._index]&&(this.skipInlineWS(),"."===this._source[this._index]);){this._index++;const t=this.getIdentifier();if(this.skipInlineWS(),"="!==this._source[this._index])throw this.error('Expected "="');this._index++,this.skipInlineWS();const n=this.getPattern();if(null===n)throw this.error("Expected attribute to have a value");e[t]="string"==typeof n?n:{val:n},this.skipBlankLines()}return e}getVariants(){const e=[];let t,n=0;for(;this._index<this._length;){const s=this._source[this._index];if(("["!==s||"["===this._source[this._index+1])&&"*"!==s)break;if("*"===s&&(this._index++,t=n),"["!==this._source[this._index])throw this.error('Expected "["');this._index++;const i=this.getVariantKey();this.skipInlineWS();const r=this.getPattern();if(null===r)throw this.error("Expected variant to have a value");e[n++]={key:i,val:r},this.skipWS()}return[e,t]}getVariantKey(){const e=this._source.charCodeAt(this._index);let t;if(t=e>=48&&e<=57||45===e?this.getNumber():this.getVariantName(),"]"!==this._source[this._index])throw this.error('Expected "]"');return this._index++,t}getLiteral(){const e=this._source.charCodeAt(this._index);if(36===e)return this._index++,{type:"ext",name:this.getIdentifier()};const t=45===e?this._source.charCodeAt(this._index+1):e;if(t>=97&&t<=122||t>=65&&t<=90)return{type:"ref",name:this.getEntryIdentifier()};if(t>=48&&t<=57)return this.getNumber();if(34===e)return this.getString();throw this.error("Expected literal")}skipComment(){let e=this._source.indexOf("\n",this._index);for(;-1!==e&&("/"===this._source[e+1]&&"/"===this._source[e+2]||"#"===this._source[e+1]&&[" ","#"].includes(this._source[e+2]))&&(this._index=e+3,-1!==(e=this._source.indexOf("\n",this._index))););this._index=-1===e?this._length:e+1}error(e){return new SyntaxError(e)}skipToNextEntryStart(){let e=this._index;for(;;){if(0===e||"\n"===this._source[e-1]){const t=this._source.charCodeAt(e);if(t>=97&&t<=122||t>=65&&t<=90||47===t||91===t)return void(this._index=e)}if(-1===(e=this._source.indexOf("\n",e)))return void(this._index=this._length);e++}}}function c(e){return(new o).getResource(e)}class l{constructor(e,t){this.value=e,this.opts=t}valueOf(){return this.value}toString(){throw new Error("Subclasses of FluentType must implement toString.")}}class d extends l{toString(){return this.value||"???"}}class u extends l{constructor(e,t){super(parseFloat(e),t)}toString(e){try{return e._memoizeIntlObject(Intl.NumberFormat,this.opts).format(this.value)}catch(e){return this.value}}match(e,t){return t instanceof u&&this.value===t.value}}class p extends l{constructor(e,t){super(new Date(e),t)}toString(e){try{return e._memoizeIntlObject(Intl.DateTimeFormat,this.opts).format(this.value)}catch(e){return this.value}}}class h extends l{toString(){return this.value}match(e,t){if(t instanceof h)return this.value===t.value;if("string"==typeof t)return this.value===t;if(t instanceof u){const n=e._memoizeIntlObject(Intl.PluralRules,t.opts);return this.value===n.select(t.value)}return!1}}var m={NUMBER:([e],t)=>new u(e.valueOf(),_(e.opts,t)),DATETIME:([e],t)=>new p(e.valueOf(),_(e.opts,t))};function _(e,t){return Object.assign({},e,function(e){const t={};for(const[n,s]of Object.entries(e))t[n]=s.valueOf();return t}(t))}const E=2500,f="⁨",g="⁩";function b(e,t,n){if(t[n])return t[n];const{errors:s}=e;return s.push(new RangeError("No default")),new d}function v(e,{name:t}){const{ctx:n,errors:s}=e,i=t.startsWith("-")?n._terms.get(t):n._messages.get(t);if(!i){const e=t.startsWith("-")?new ReferenceError(`Unknown term: ${t}`):new ReferenceError(`Unknown message: ${t}`);return s.push(e),new d(t)}return i}function S(e,t){if("string"==typeof t||t instanceof d)return t;if(Array.isArray(t))return function(e,t){const{ctx:n,dirty:s,errors:i}=e;if(s.has(t))return i.push(new RangeError("Cyclic reference")),new d;s.add(t);const r=[],a=n._useIsolating&&t.length>1;for(const s of t){if("string"==typeof s){r.push(s);continue}const t=S(e,s).toString(n);a&&r.push(f),t.length>E?(i.push(new RangeError("Too many characters in placeable "+`(${t.length}, max allowed is ${E})`)),r.push(t.slice(E))):r.push(t),a&&r.push(g)}return s.delete(t),r.join("")}(e,t);switch(t.type){case"varname":return new h(t.name);case"num":return new u(t.val);case"ext":return function(e,{name:t}){const{args:n,errors:s}=e;if(!n||!n.hasOwnProperty(t))return s.push(new ReferenceError(`Unknown external: ${t}`)),new d(t);const i=n[t];if(i instanceof l)return i;switch(typeof i){case"string":return i;case"number":return new u(i);case"object":if(i instanceof Date)return new p(i);default:return s.push(new TypeError(`Unsupported external type: ${t}, ${typeof i}`)),new d(t)}}(e,t);case"fun":return y(e,t);case"call":return function(e,{fun:t,args:n}){const s=y(e,t);if(s instanceof d)return s;const i=[],r={};for(const t of n)"narg"===t.type?r[t.name]=S(e,t.val):i.push(S(e,t));try{return s(i,r)}catch(e){return new d}}(e,t);case"ref":return S(e,v(e,t));case"attr":return S(e,function(e,{id:t,name:n}){const s=v(e,t);if(s instanceof d)return s;if(s.attrs)for(const e in s.attrs)if(n===e)return s.attrs[n];const{errors:i}=e;return i.push(new ReferenceError(`Unknown attribute: ${n}`)),S(e,s)}(e,t));case"var":return S(e,function(e,{id:t,key:n}){const s=v(e,t);if(s instanceof d)return s;const{ctx:i,errors:r}=e,a=S(e,n);if(function(e){return Array.isArray(e)&&"sel"===e[0].type&&null===e[0].exp}(s.val))for(const t of s.val[0].vars){const n=S(e,t.key);if(a.match(i,n))return t}return r.push(new ReferenceError(`Unknown variant: ${a.toString(i)}`)),S(e,s)}(e,t));case"sel":return S(e,function(e,{exp:t,vars:n,def:s}){if(null===t)return b(e,n,s);const i=S(e,t);if(i instanceof d)return b(e,n,s);for(const t of n){const n=S(e,t.key);if(!(n instanceof u||n instanceof h))continue;const{ctx:s}=e;if(n.match(s,i))return t}return b(e,n,s)}(e,t));case void 0:{if(null!==t.val&&void 0!==t.val)return S(e,t.val);const{errors:n}=e;return n.push(new RangeError("No value")),new d}default:return new d}}function y(e,{name:t}){const{ctx:{_functions:n},errors:s}=e,i=n[t]||m[t];return i?"function"!=typeof i?(s.push(new TypeError(`Function ${t}() is not callable`)),new d(`${t}()`)):i:(s.push(new ReferenceError(`Unknown function: ${t}()`)),new d(`${t}()`))}class T{constructor(e,{functions:t={},useIsolating:n=!0}={}){this.locales=Array.isArray(e)?e:[e],this._terms=new Map,this._messages=new Map,this._functions=t,this._useIsolating=n,this._intls=new WeakMap}get messages(){return this._messages[Symbol.iterator]()}hasMessage(e){return this._messages.has(e)}getMessage(e){return this._messages.get(e)}addMessages(e){const[t,n]=c(e);for(const e in t)if(e.startsWith("-")){if(this._terms.has(e)){n.push(`Attempt to override an existing term: "${e}"`);continue}this._terms.set(e,t[e])}else{if(this._messages.has(e)){n.push(`Attempt to override an existing message: "${e}"`);continue}this._messages.set(e,t[e])}return n}format(e,t,n){return"string"==typeof e?e:"string"==typeof e.val?e.val:void 0===e.val?null:function(e,t,n,s=[]){return S({ctx:e,args:t,errors:s,dirty:new WeakSet},n).toString(e)}(this,t,e,n)}_memoizeIntlObject(e,t){const n=this._intls.get(e)||{},s=JSON.stringify(t);return n[s]||(n[s]=new e(this.locales,t),this._intls.set(e,n)),n[s]}}class O{constructor(e){if(Symbol.asyncIterator in Object(e))this.iterator=e[Symbol.asyncIterator]();else{if(!(Symbol.iterator in Object(e)))throw new TypeError("Argument must implement the iteration protocol.");this.iterator=e[Symbol.iterator]()}this.seen=[]}[Symbol.iterator](){const{seen:e,iterator:t}=this;let n=0;return{next:()=>(e.length<=n&&e.push(t.next()),e[n++])}}[Symbol.asyncIterator](){const{seen:e,iterator:t}=this;let n=0;return{next:()=>(function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(i,r){try{var a=t[i](r),o=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(o).then(function(e){s("next",e)},function(e){s("throw",e)});e(o)}("next")})}})(function*(){return e.length<=n&&e.push(yield t.next()),e[n++]})()}}touchNext(){const{seen:e,iterator:t}=this;0!==e.length&&!1!==e[e.length-1].done||e.push(t.next())}}function C(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var t=e[Symbol.asyncIterator];if(null!=t)return t.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")}function k(e,t){return Array.isArray(t)?t.map(t=>I(e,t)):I(e,t)}function I(e,t){for(const n of e)if(n.hasMessage(t))return n;return null}(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(i,r){try{var a=t[i](r),o=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(o).then(function(e){s("next",e)},function(e){s("throw",e)});e(o)}("next")})}}(function*(e,t){if(!Array.isArray(t)){var n=!0,s=!1,i=void 0;try{for(var r,a,o=C(e);n=(r=yield o.next()).done,a=yield r.value,!n;n=!0){const e=a;if(e.hasMessage(t))return e}}catch(e){s=!0,i=e}finally{try{!n&&o.return&&(yield o.return())}finally{if(s)throw i}}}let c=t.length;const l=new Array(c).fill(null);var d=!0,u=!1,p=void 0;try{for(var h,m,_=C(e);d=(h=yield _.next()).done,m=yield h.value,!d;d=!0){const e=m;for(let n=0;n<t.length;n++){const s=t[n];if(!l[n]&&e.hasMessage(s)&&(l[n]=e,c--),0===c)return l}}}catch(e){u=!0,p=e}finally{try{!d&&_.return&&(yield _.return())}finally{if(u)throw p}}return l})})();n.d(t,!1,function(){return c}),n.d(t,"b",function(){return T}),n.d(t,!1,function(){return l}),n.d(t,!1,function(){return u}),n.d(t,!1,function(){return p}),n.d(t,"a",function(){return O}),n.d(t,"c",function(){return k}),n.d(t,!1,function(){}),n.d(t,!1,function(){})},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var s=n(2),i=n(0),r=n.n(i);class a extends r.a.PureComponent{constructor(e){super(e),this.windowObj=this.props.windowObj||window,this.onClick=this.onClick.bind(this)}onClick(){this.windowObj.location.reload(!0)}render(){let e;return e="className"in this.props?`${this.props.className} as-error-fallback`:"as-error-fallback",r.a.createElement("div",{className:e},r.a.createElement("div",null,r.a.createElement(s.FormattedMessage,{defaultMessage:"Oops, something went wrong loading this content.",id:"error_fallback_default_info"})),r.a.createElement("span",null,r.a.createElement("a",{href:"#",className:"reload-button",onClick:this.onClick},r.a.createElement(s.FormattedMessage,{defaultMessage:"Refresh page to try again.",id:"error_fallback_default_refresh_suggestion"}))))}}a.defaultProps={className:"as-error-fallback"};class o extends r.a.PureComponent{constructor(e){super(e),this.state={hasError:!1}}componentDidCatch(e,t){this.setState({hasError:!0})}render(){return this.state.hasError?r.a.createElement(this.props.FallbackComponent,{className:this.props.className}):this.props.children}}o.defaultProps={FallbackComponent:a}},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";n.d(t,"a",function(){return p}),n.d(t,"b",function(){return E});var s=n(1),i=n(2),r=n(4),a=n(19),o=n(0),c=n.n(o),l=n(7),d=n(9),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e};class p extends c.a.PureComponent{constructor(e){super(e),this.state={screenshotImage:null},this.onDragEvent=this.onDragEvent.bind(this)}_allowDrop(e){return e.dataTransfer.types.includes("text/topsite-index")}onDragEvent(e){switch(e.type){case"click":this.dragged&&e.preventDefault();break;case"dragstart":this.dragged=!0,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/topsite-index",this.props.index),e.target.blur(),this.props.onDragEvent(e,this.props.index,this.props.link,this.props.title);break;case"dragend":this.props.onDragEvent(e);break;case"dragenter":case"dragover":case"drop":this._allowDrop(e)&&(e.preventDefault(),this.props.onDragEvent(e,this.props.index));break;case"mousedown":this.dragged=!1}}static getNextStateFromProps(e,t){const{screenshot:n}=e.link;return l.a.isRemoteImageLocal(t.screenshotImage,n)?null:(l.a.maybeRevokeBlobObjectURL(t.screenshotImage),{screenshotImage:l.a.createLocalImageObject(n)})}componentWillMount(){const e=p.getNextStateFromProps(this.props,this.state);e&&this.setState(e)}componentWillReceiveProps(e){const t=p.getNextStateFromProps(e,this.state);t&&this.setState(t)}componentWillUnmount(){l.a.maybeRevokeBlobObjectURL(this.state.screenshotImage)}render(){const{children:e,className:t,defaultStyle:n,isDraggable:s,link:i,onClick:a,title:o}=this.props,l=`top-site-outer${t?` ${t}`:""}${i.isDragged?" dragged":""}`,{tippyTopIcon:d,faviconSize:p}=i,[h]=o;let m,_,E,f,g=!1,b=this.state.screenshotImage&&this.state.screenshotImage.url;n?f=!1:i.customScreenshotURL?(m="top-site-icon rich-icon",_={backgroundColor:i.backgroundColor,backgroundImage:b?`url(${this.state.screenshotImage.url})`:"none"}):d||p>=r.b?(m="top-site-icon rich-icon",_={backgroundColor:i.backgroundColor,backgroundImage:`url(${d||i.favicon})`}):(m=`screenshot${b?" active":""}`,_={backgroundImage:b?`url(${this.state.screenshotImage.url})`:"none"},p>=r.a?(g=!0,E={backgroundImage:`url(${i.favicon})`}):b&&(g=!0,f=!0));let v={};return s&&(v={onClick:this.onDragEvent,onDragEnd:this.onDragEvent,onDragStart:this.onDragEvent,onMouseDown:this.onDragEvent}),c.a.createElement("li",u({className:l,onDrop:this.onDragEvent,onDragOver:this.onDragEvent,onDragEnter:this.onDragEvent,onDragLeave:this.onDragEvent},v),c.a.createElement("div",{className:"top-site-inner"},c.a.createElement("a",{href:i.url,onClick:a},c.a.createElement("div",{className:"tile","aria-hidden":!0,"data-fallback":h},c.a.createElement("div",{className:m,style:_}),g&&c.a.createElement("div",{className:"top-site-icon default-icon","data-fallback":f&&h,style:E})),c.a.createElement("div",{className:`title ${i.isPinned?"pinned":""}`},i.isPinned&&c.a.createElement("div",{className:"icon icon-pin-small"}),c.a.createElement("span",{dir:"auto"},o))),e))}}p.defaultProps={title:"",link:{},isDraggable:!0};class h extends c.a.PureComponent{constructor(e){super(e),this.state={showContextMenu:!1},this.onLinkClick=this.onLinkClick.bind(this),this.onMenuButtonClick=this.onMenuButtonClick.bind(this),this.onMenuUpdate=this.onMenuUpdate.bind(this)}_getTelemetryInfo(){const e={icon_type:this.props.link.iconType};return this.props.link.isPinned&&(e.card_type="pinned"),{value:e}}userEvent(e){this.props.dispatch(s.b.UserEvent(Object.assign({event:e,source:r.d,action_position:this.props.index},this._getTelemetryInfo())))}onLinkClick(e){this.userEvent("CLICK"),e.preventDefault();const{altKey:t,button:n,ctrlKey:i,metaKey:r,shiftKey:a}=e;this.props.dispatch(s.b.OnlyToMain({type:s.c.OPEN_LINK,data:Object.assign(this.props.link,{event:{altKey:t,button:n,ctrlKey:i,metaKey:r,shiftKey:a}})}))}onMenuButtonClick(e){e.preventDefault(),this.props.onActivate(this.props.index),this.setState({showContextMenu:!0})}onMenuUpdate(e){this.setState({showContextMenu:e})}render(){const{props:e}=this,{link:t}=e,n=this.state.showContextMenu&&e.activeIndex===e.index,s=t.label||t.hostname;return c.a.createElement(p,u({},e,{onClick:this.onLinkClick,onDragEvent:this.props.onDragEvent,className:`${e.className||""}${n?" active":""}`,title:s}),c.a.createElement("div",null,c.a.createElement("button",{className:"context-menu-button icon",onClick:this.onMenuButtonClick},c.a.createElement("span",{className:"sr-only"},c.a.createElement(i.FormattedMessage,{id:"context_menu_button_sr",values:{title:s}}))),n&&c.a.createElement(a.a,{dispatch:e.dispatch,index:e.index,onUpdate:this.onMenuUpdate,options:r.c,site:t,siteInfo:this._getTelemetryInfo(),source:r.d})))}}h.defaultProps={link:{},onActivate(){}};class m extends c.a.PureComponent{constructor(e){super(e),this.onEditButtonClick=this.onEditButtonClick.bind(this)}onEditButtonClick(){this.props.dispatch({type:s.c.TOP_SITES_EDIT,data:{index:this.props.index}})}render(){return c.a.createElement(p,u({},this.props,{className:`placeholder ${this.props.className||""}`,isDraggable:!1}),c.a.createElement("button",{className:"context-menu-button edit-button icon",title:this.props.intl.formatMessage({id:"edit_topsites_edit_button"}),onClick:this.onEditButtonClick}))}}class _ extends c.a.PureComponent{static get DEFAULT_STATE(){return{activeIndex:null,draggedIndex:null,draggedSite:null,draggedTitle:null,topSitesPreview:null}}constructor(e){super(e),this.state=_.DEFAULT_STATE,this.onDragEvent=this.onDragEvent.bind(this),this.onActivate=this.onActivate.bind(this)}componentWillReceiveProps(e){if(this.state.draggedSite){const t=this.props.TopSites&&this.props.TopSites.rows,n=e.TopSites&&e.TopSites.rows;!t||!t[this.state.draggedIndex]||t[this.state.draggedIndex].url!==this.state.draggedSite.url||n[this.state.draggedIndex]&&n[this.state.draggedIndex].url===this.state.draggedSite.url||this.setState(_.DEFAULT_STATE)}}userEvent(e,t){this.props.dispatch(s.b.UserEvent({event:e,source:r.d,action_position:t}))}onDragEvent(e,t,n,i){switch(e.type){case"dragstart":this.dropped=!1,this.setState({draggedIndex:t,draggedSite:n,draggedTitle:i,activeIndex:null}),this.userEvent("DRAG",t);break;case"dragend":this.dropped||this.setState(_.DEFAULT_STATE);break;case"dragenter":t===this.state.draggedIndex?this.setState({topSitesPreview:null}):this.setState({topSitesPreview:this._makeTopSitesPreview(t)});break;case"drop":t!==this.state.draggedIndex&&(this.dropped=!0,this.props.dispatch(s.b.AlsoToMain({type:s.c.TOP_SITES_INSERT,data:{site:{url:this.state.draggedSite.url,label:this.state.draggedTitle,customScreenshotURL:this.state.draggedSite.customScreenshotURL},index:t,draggedFromIndex:this.state.draggedIndex}})),this.userEvent("DROP",t))}}_getTopSites(){let e=this.props.TopSites.rows.slice();return e.length=this.props.TopSitesRows*d.a,e}_makeTopSitesPreview(e){const t=this._getTopSites();t[this.state.draggedIndex]=null;const n=t.map(e=>e&&e.isPinned?e:null),s=t.filter(e=>e&&!e.isPinned),i=Object.assign({},this.state.draggedSite,{isPinned:!0,isDragged:!0});if(n[e]){let t=e;const s=e>this.state.draggedIndex?-1:1;for(;n[t];)t+=s;const r=e>this.state.draggedIndex?1:-1;for(;t!==e;){const e=t+r;n[t]=n[e],t=e}n[e]=i}else n[e]=i;const r=n;for(let e=0;e<r.length;e++)r[e]||(r[e]=s.shift()||null);return r}onActivate(e){this.setState({activeIndex:e})}render(){const{props:e}=this,t=this.state.topSitesPreview||this._getTopSites(),n=[],s={onDragEvent:this.onDragEvent,dispatch:e.dispatch,intl:e.intl};let i=0;const r=6*e.TopSitesRows;for(let e=0,a=t.length;e<a;e++){const a=t[e]&&Object.assign({},t[e],{iconType:this.props.topSiteIconType(t[e])}),o={key:a?a.url:i++,index:e};e>=r&&(o.className="hide-for-narrow"),n.push(a?c.a.createElement(h,u({link:a,activeIndex:this.state.activeIndex,onActivate:this.onActivate},o,s)):c.a.createElement(m,u({},o,s)))}return c.a.createElement("ul",{className:`top-sites-list${this.state.draggedSite?" dnd-active":""}`},n)}}const E=Object(i.injectIntl)(_)},function(e,t,n){"use strict";let s;function i(e){e&&e.performanceObj?this._perf=e.performanceObj:this._perf=s}n.d(t,"a",function(){return r}),"undefined"!=typeof ChromeUtils&&ChromeUtils.import("resource://gre/modules/Services.jsm"),s="undefined"!=typeof Services?Services.appShell.hiddenDOMWindow.performance:"undefined"!=typeof performance?performance:{now(){},mark(){}},i.prototype={mark:function(e){this._perf.mark(e)},getEntriesByName:function(e,t){return this._perf.getEntriesByName(e,t)},get timeOrigin(){return this._perf.timeOrigin},absNow:function(){return this.timeOrigin+this._perf.now()},getMostRecentAbsMarkStartByName(e){let t=this.getEntriesByName(e,"mark");if(!t.length)throw new Error(`No marks with the name ${e}`);let n=t[t.length-1];return this._perf.timeOrigin+n.startTime}};var r=new i},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var s=n(1),i=n(14),r=n(0),a=n.n(r);const o=["highlights","topsites"];class c extends a.a.Component{constructor(e){super(e),this.perfSvc=this.props.perfSvc||i.a,this._sendBadStateEvent=this._sendBadStateEvent.bind(this),this._sendPaintedEvent=this._sendPaintedEvent.bind(this),this._reportMissingData=!1,this._timestampHandled=!1,this._recordedFirstRender=!1}componentDidMount(){o.includes(this.props.id)&&this._maybeSendPaintedEvent()}componentDidUpdate(){o.includes(this.props.id)&&this._maybeSendPaintedEvent()}_afterFramePaint(e){requestAnimationFrame(()=>setTimeout(e,0))}_maybeSendBadStateEvent(){this.props.initialized?this._reportMissingData&&(this._reportMissingData=!1,this._sendBadStateEvent()):this._reportMissingData=!0}_maybeSendPaintedEvent(){!this._timestampHandled&&this.props.initialized&&(this._timestampHandled=!0,this._afterFramePaint(this._sendPaintedEvent))}_ensureFirstRenderTsRecorded(){if(!this._recordedFirstRender){this._recordedFirstRender=!0;const e=`${this.props.id}_first_render_ts`;this.perfSvc.mark(e)}}_sendBadStateEvent(){const e=`${this.props.id}_data_ready_ts`;this.perfSvc.mark(e);try{const t=`${this.props.id}_first_render_ts`,n=parseInt(this.perfSvc.getMostRecentAbsMarkStartByName(e)-this.perfSvc.getMostRecentAbsMarkStartByName(t),10);this.props.dispatch(s.b.OnlyToMain({type:s.c.SAVE_SESSION_PERF_DATA,data:{[`${this.props.id}_data_late_by_ms`]:n}}))}catch(e){}}_sendPaintedEvent(){if("topsites"!==this.props.id)return;const e=`${this.props.id}_first_painted_ts`;this.perfSvc.mark(e);try{const t={};t[e]=this.perfSvc.getMostRecentAbsMarkStartByName(e),this.props.dispatch(s.b.OnlyToMain({type:s.c.SAVE_SESSION_PERF_DATA,data:t}))}catch(e){}}render(){return o.includes(this.props.id)&&(this._ensureFirstRenderTsRecorded(),this._maybeSendBadStateEvent()),this.props.children}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var s=n(1);const i={Separator:()=>({type:"separator"}),MoveUp:e=>({id:"section_menu_action_move_up",icon:"arrowhead-up",action:s.b.OnlyToMain({type:s.c.SECTION_MOVE,data:{id:e.id,direction:-1}}),userEvent:"MENU_MOVE_UP",disabled:!!e.isFirst}),MoveDown:e=>({id:"section_menu_action_move_down",icon:"arrowhead-down",action:s.b.OnlyToMain({type:s.c.SECTION_MOVE,data:{id:e.id,direction:1}}),userEvent:"MENU_MOVE_DOWN",disabled:!!e.isLast}),RemoveSection:e=>({id:"section_menu_action_remove_section",icon:"dismiss",action:s.b.SetPref(e.showPrefName,!1),userEvent:"MENU_REMOVE"}),CollapseSection:e=>({id:"section_menu_action_collapse_section",icon:"minimize",action:s.b.OnlyToMain({type:s.c.UPDATE_SECTION_PREFS,data:{id:e.id,value:{collapsed:!0}}}),userEvent:"MENU_COLLAPSE"}),ExpandSection:e=>({id:"section_menu_action_expand_section",icon:"maximize",action:s.b.OnlyToMain({type:s.c.UPDATE_SECTION_PREFS,data:{id:e.id,value:{collapsed:!1}}}),userEvent:"MENU_EXPAND"}),ManageSection:e=>({id:"section_menu_action_manage_section",icon:"settings",action:s.b.OnlyToMain({type:s.c.SETTINGS_OPEN}),userEvent:"MENU_MANAGE"}),ManageWebExtension:e=>({id:"section_menu_action_manage_webext",icon:"settings",action:s.b.OnlyToMain({type:s.c.OPEN_WEBEXT_SETTINGS,data:e.id})}),AddTopSite:e=>({id:"section_menu_action_add_topsite",icon:"add",action:{type:s.c.TOP_SITES_EDIT,data:{index:-1}},userEvent:"MENU_ADD_TOPSITE"}),PrivacyNotice:e=>({id:"section_menu_action_privacy_notice",icon:"info",action:s.b.OnlyToMain({type:s.c.OPEN_LINK,data:{url:e.privacyNoticeURL}}),userEvent:"MENU_PRIVACY_NOTICE"}),CheckCollapsed:e=>e.collapsed?i.ExpandSection(e):i.CollapseSection(e)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return _});var s=n(2),i=n(1),r=n(11),a=n(0),o=n.n(a),c=n(34),l=n(16);const d="visible",u="visibilitychange";function p(e){return"string"==typeof e?o.a.createElement("span",null,e):o.a.createElement(s.FormattedMessage,e)}const h=Object(s.injectIntl)(class extends o.a.PureComponent{constructor(e){super(e),this.onAcknowledge=this.onAcknowledge.bind(this)}onAcknowledge(){this.props.dispatch(i.b.SetPref(this.props.disclaimerPref,!1)),this.props.dispatch(i.b.UserEvent({event:"DISCLAIMER_ACKED",source:this.props.eventSource}))}render(){const{disclaimer:e}=this.props;return o.a.createElement("div",{className:"section-disclaimer"},o.a.createElement("div",{className:"section-disclaimer-text"},p(e.text),e.link&&o.a.createElement("a",{href:e.link.href,target:"_blank",rel:"noopener noreferrer"},p(e.link.title||e.link))),o.a.createElement("button",{onClick:this.onAcknowledge},p(e.button)))}});class m extends o.a.PureComponent{constructor(e){super(e),this.onBodyMount=this.onBodyMount.bind(this),this.onHeaderClick=this.onHeaderClick.bind(this),this.onTransitionEnd=this.onTransitionEnd.bind(this),this.enableOrDisableAnimation=this.enableOrDisableAnimation.bind(this),this.onMenuButtonClick=this.onMenuButtonClick.bind(this),this.onMenuButtonMouseEnter=this.onMenuButtonMouseEnter.bind(this),this.onMenuButtonMouseLeave=this.onMenuButtonMouseLeave.bind(this),this.onMenuUpdate=this.onMenuUpdate.bind(this),this.state={enableAnimation:!0,isAnimating:!1,menuButtonHover:!1,showContextMenu:!1}}componentWillMount(){this.props.document.addEventListener(u,this.enableOrDisableAnimation)}componentWillUpdate(e){!this.props.collapsed&&e.collapsed&&this.sectionBody.scrollHeight}componentWillUnmount(){this.props.document.removeEventListener(u,this.enableOrDisableAnimation)}enableOrDisableAnimation(){const e=this.props.document.visibilityState===d;this.state.enableAnimation!==e&&this.setState({enableAnimation:e})}onBodyMount(e){this.sectionBody=e}onHeaderClick(){if(!this.sectionBody||void 0===this.props.collapsed)return;this.setState({isAnimating:!0,maxHeight:`${this.sectionBody.scrollHeight}px`});const{action:e,userEvent:t}=l.a.CheckCollapsed(this.props);this.props.dispatch(e),this.props.dispatch(i.b.UserEvent({event:t,source:this.props.source}))}onTransitionEnd(e){e.target===e.currentTarget&&this.setState({isAnimating:!1})}renderIcon(){const{icon:e}=this.props;return e&&e.startsWith("moz-extension://")?o.a.createElement("span",{className:"icon icon-small-spacer",style:{backgroundImage:`url('${e}')`}}):o.a.createElement("span",{className:`icon icon-small-spacer icon-${e||"webextension"}`})}onMenuButtonClick(e){e.preventDefault(),this.setState({showContextMenu:!0})}onMenuButtonMouseEnter(){this.setState({menuButtonHover:!0})}onMenuButtonMouseLeave(){this.setState({menuButtonHover:!1})}onMenuUpdate(e){this.setState({showContextMenu:e})}render(){const e=void 0!==this.props.collapsed,{enableAnimation:t,isAnimating:n,maxHeight:i,menuButtonHover:a,showContextMenu:l}=this.state,{id:d,eventSource:u,collapsed:m,disclaimer:_,title:E,extraMenuOptions:f,showPrefName:g,privacyNoticeURL:b,dispatch:v,isFirst:S,isLast:y,isWebExtension:T}=this.props,O=`section.${d}.showDisclaimer`,C=_&&this.props.Prefs.values[O],k=a||l;return o.a.createElement("section",{className:`collapsible-section ${this.props.className}${t?" animation-enabled":""}${m?" collapsed":""}${k?" active":""}`,"data-section-id":d},o.a.createElement("div",{className:"section-top-bar"},o.a.createElement("h3",{className:"section-title"},o.a.createElement("span",{className:"click-target",onClick:this.onHeaderClick},this.renderIcon(),p(E),e&&o.a.createElement("span",{className:`collapsible-arrow icon ${m?"icon-arrowhead-forward-small":"icon-arrowhead-down-small"}`}))),o.a.createElement("div",null,o.a.createElement("button",{className:"context-menu-button icon",onClick:this.onMenuButtonClick,onMouseEnter:this.onMenuButtonMouseEnter,onMouseLeave:this.onMenuButtonMouseLeave},o.a.createElement("span",{className:"sr-only"},o.a.createElement(s.FormattedMessage,{id:"section_context_menu_button_sr"}))),l&&o.a.createElement(c.a,{id:d,extraOptions:f,eventSource:u,showPrefName:g,privacyNoticeURL:b,collapsed:m,onUpdate:this.onMenuUpdate,isFirst:S,isLast:y,dispatch:v,isWebExtension:T}))),o.a.createElement(r.a,{className:"section-body-fallback"},o.a.createElement("div",{className:`section-body${n?" animating":""}`,onTransitionEnd:this.onTransitionEnd,ref:this.onBodyMount,style:n&&!m?{maxHeight:i}:null},C&&o.a.createElement(h,{disclaimerPref:O,disclaimer:_,eventSource:u,dispatch:this.props.dispatch}),this.props.children)))}}m.defaultProps={document:e.document||{addEventListener:()=>{},removeEventListener:()=>{},visibilityState:"hidden"},Prefs:{values:{}}};const _=Object(s.injectIntl)(m)}).call(this,n(5))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return r});var s=n(0),i=n.n(s);class r extends i.a.PureComponent{constructor(e){super(e),this.hideContext=this.hideContext.bind(this),this.onClick=this.onClick.bind(this)}hideContext(){this.props.onUpdate(!1)}componentDidMount(){setTimeout(()=>{e.addEventListener("click",this.hideContext)},0)}componentWillUnmount(){e.removeEventListener("click",this.hideContext)}onClick(e){e.stopPropagation()}render(){return i.a.createElement("span",{className:"context-menu",onClick:this.onClick},i.a.createElement("ul",{role:"menu",className:"context-menu-list"},this.props.options.map((e,t)=>"separator"===e.type?i.a.createElement("li",{key:t,className:"separator"}):"empty"!==e.type&&i.a.createElement(a,{key:t,option:e,hideContext:this.hideContext}))))}}class a extends i.a.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this),this.onKeyDown=this.onKeyDown.bind(this)}onClick(){this.props.hideContext(),this.props.option.onClick()}onKeyDown(e){const{option:t}=this.props;switch(e.key){case"Tab":(e.shiftKey&&t.first||!e.shiftKey&&t.last)&&this.props.hideContext();break;case"Enter":this.props.hideContext(),t.onClick()}}render(){const{option:e}=this.props;return i.a.createElement("li",{role:"menuitem",className:"context-menu-item"},i.a.createElement("a",{onClick:this.onClick,onKeyDown:this.onKeyDown,tabIndex:"0",className:e.disabled?"disabled":""},e.icon&&i.a.createElement("span",{className:`icon icon-spacer icon-${e.icon}`}),e.label))}}}).call(this,n(5))},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var s=n(1),i=n(3),r=n(18),a=n(2),o=n(20),c=n(0),l=n.n(c);const d=["CheckPinTopSite","EditTopSite","Separator","OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl"];const u=Object(i.connect)(e=>({isPrivateBrowsingEnabled:e.Prefs.values.isPrivateBrowsingEnabled,platform:e.Prefs.values.platform}))(Object(a.injectIntl)(class extends l.a.PureComponent{getOptions(){const{props:e}=this,{site:t,index:n,source:i,isPrivateBrowsingEnabled:r,siteInfo:a,platform:c}=e,l=(t.isDefault?d:e.options).map(e=>o.b[e](t,n,i,r,a,c)).map(t=>{const{action:r,impression:o,id:c,string_id:l,type:d,userEvent:u}=t;return!d&&c&&(t.label=e.intl.formatMessage({id:l||c}),t.onClick=(()=>{if(e.dispatch(r),u){const t=Object.assign({event:u,source:i,action_position:n},a);e.dispatch(s.b.UserEvent(t))}o&&e.shouldSendImpressionStats&&e.dispatch(o)})),t});return l[0].first=!0,l[l.length-1].last=!0,l}render(){return l.a.createElement(r.a,{onUpdate:this.props.onUpdate,options:this.getOptions()})}}))},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r});var s=n(1);const i=e=>{switch(e){case"win":return"menu_action_show_file_windows";case"macosx":return"menu_action_show_file_mac_os";case"linux":return"menu_action_show_file_linux";default:return"menu_action_show_file_default"}},r={Separator:()=>({type:"separator"}),EmptyItem:()=>({type:"empty"}),RemoveBookmark:e=>({id:"menu_action_remove_bookmark",icon:"bookmark-added",action:s.b.AlsoToMain({type:s.c.DELETE_BOOKMARK_BY_ID,data:e.bookmarkGuid}),userEvent:"BOOKMARK_DELETE"}),AddBookmark:e=>({id:"menu_action_bookmark",icon:"bookmark-hollow",action:s.b.AlsoToMain({type:s.c.BOOKMARK_URL,data:{url:e.url,title:e.title,type:e.type}}),userEvent:"BOOKMARK_ADD"}),OpenInNewWindow:e=>({id:"menu_action_open_new_window",icon:"new-window",action:s.b.AlsoToMain({type:s.c.OPEN_NEW_WINDOW,data:{referrer:e.referrer,typedBonus:e.typedBonus,url:e.url}}),userEvent:"OPEN_NEW_WINDOW"}),BlockUrl:(e,t,n)=>({id:"menu_action_dismiss",icon:"dismiss",action:s.b.AlsoToMain({type:s.c.BLOCK_URL,data:{url:e.url,pocket_id:e.pocket_id}}),impression:s.b.ImpressionStats({source:n,block:0,tiles:[{id:e.guid,pos:t}]}),userEvent:"BLOCK"}),WebExtDismiss:(e,t,n)=>({id:"menu_action_webext_dismiss",string_id:"menu_action_dismiss",icon:"dismiss",action:s.b.WebExtEvent(s.c.WEBEXT_DISMISS,{source:n,url:e.url,action_position:t})}),DeleteUrl:(e,t,n,i,r)=>({id:"menu_action_delete",icon:"delete",action:{type:s.c.DIALOG_OPEN,data:{onConfirm:[s.b.AlsoToMain({type:s.c.DELETE_HISTORY_URL,data:{url:e.url,pocket_id:e.pocket_id,forceBlock:e.bookmarkGuid}}),s.b.UserEvent(Object.assign({event:"DELETE",source:n,action_position:t},r))],eventSource:n,body_string_id:["confirm_history_delete_p1","confirm_history_delete_notice_p2"],confirm_button_string_id:"menu_action_delete",cancel_button_string_id:"topsites_form_cancel_button",icon:"modal-delete"}},userEvent:"DIALOG_OPEN"}),ShowFile:(e,t,n,r,a,o)=>({id:i(o),icon:"search",action:s.b.OnlyToMain({type:s.c.SHOW_DOWNLOAD_FILE,data:{url:e.url}})}),OpenFile:e=>({id:"menu_action_open_file",icon:"open-file",action:s.b.OnlyToMain({type:s.c.OPEN_DOWNLOAD_FILE,data:{url:e.url}})}),CopyDownloadLink:e=>({id:"menu_action_copy_download_link",icon:"copy",action:s.b.OnlyToMain({type:s.c.COPY_DOWNLOAD_LINK,data:{url:e.url}})}),GoToDownloadPage:e=>({id:"menu_action_go_to_download_page",icon:"download",action:s.b.OnlyToMain({type:s.c.OPEN_LINK,data:{url:e.referrer}}),disabled:!e.referrer}),RemoveDownload:e=>({id:"menu_action_remove_download",icon:"delete",action:s.b.OnlyToMain({type:s.c.REMOVE_DOWNLOAD_FILE,data:{url:e.url}})}),PinTopSite:(e,t)=>({id:"menu_action_pin",icon:"pin",action:s.b.AlsoToMain({type:s.c.TOP_SITES_PIN,data:{site:{url:e.url},index:t}}),userEvent:"PIN"}),UnpinTopSite:e=>({id:"menu_action_unpin",icon:"unpin",action:s.b.AlsoToMain({type:s.c.TOP_SITES_UNPIN,data:{site:{url:e.url}}}),userEvent:"UNPIN"}),SaveToPocket:(e,t,n)=>({id:"menu_action_save_to_pocket",icon:"pocket",action:s.b.AlsoToMain({type:s.c.SAVE_TO_POCKET,data:{site:{url:e.url,title:e.title}}}),impression:s.b.ImpressionStats({source:n,pocket:0,tiles:[{id:e.guid,pos:t}]}),userEvent:"SAVE_TO_POCKET"}),DeleteFromPocket:e=>({id:"menu_action_delete_pocket",icon:"delete",action:s.b.AlsoToMain({type:s.c.DELETE_FROM_POCKET,data:{pocket_id:e.pocket_id}}),userEvent:"DELETE_FROM_POCKET"}),ArchiveFromPocket:e=>({id:"menu_action_archive_pocket",icon:"check",action:s.b.AlsoToMain({type:s.c.ARCHIVE_FROM_POCKET,data:{pocket_id:e.pocket_id}}),userEvent:"ARCHIVE_FROM_POCKET"}),EditTopSite:(e,t)=>({id:"edit_topsites_button_text",icon:"edit",action:{type:s.c.TOP_SITES_EDIT,data:{index:t}}}),CheckBookmark:e=>e.bookmarkGuid?r.RemoveBookmark(e):r.AddBookmark(e),CheckPinTopSite:(e,t)=>e.isPinned?r.UnpinTopSite(e):r.PinTopSite(e,t),CheckSavedToPocket:(e,t)=>e.pocket_id?r.DeleteFromPocket(e):r.SaveToPocket(e,t),CheckBookmarkOrArchive:e=>e.pocket_id?r.ArchiveFromPocket(e):r.CheckBookmark(e),OpenInPrivateWindow:(e,t,n,i)=>i?(e=>({id:"menu_action_open_private_window",icon:"new-window-private",action:s.b.OnlyToMain({type:s.c.OPEN_PRIVATE_WINDOW,data:{url:e.url,referrer:e.referrer}}),userEvent:"OPEN_PRIVATE_WINDOW"}))(e):r.EmptyItem()}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return a}),n.d(t,"b",function(){return p});var s=n(1),i=n(23);const r="NEW_TAB_INITIAL_STATE",a="ActivityStream:ContentToMain",o="ActivityStream:MainToContent",c=[s.c.SAVE_SESSION_PERF_DATA,s.c.PAGE_PRERENDERED];const l=e=>e=>t=>{const n=t.meta&&t.meta.skipLocal;s.d.isSendToMain(t)&&sendAsyncMessage(a,t),n||e(t)},d=e=>t=>n=>{if(e._didRehydrate)return t(n);const i=n.type===r;return n.type===s.c.NEW_TAB_STATE_REQUEST?(e._didRequestInitialState=!0,t(n)):i?(e._didRehydrate=!0,t(n)):e._didRequestInitialState&&n.type===s.c.INIT?t(s.b.AlsoToMain({type:s.c.NEW_TAB_STATE_REQUEST})):s.d.isBroadcastToContent(n)||s.d.isSendToOneContent(n)||s.d.isSendToPreloaded(n)?null:t(n)},u=e=>t=>n=>{e._receivedFromMain?t(n):s.d.isFromMain(n)?(t(n),e._receivedFromMain=!0,e._earlyActionQueue&&(e._earlyActionQueue.forEach(t),e._earlyActionQueue=[])):c.includes(n.type)?(e._earlyActionQueue=e._earlyActionQueue||[],e._earlyActionQueue.push(n)):t(n)};function p(t,n){const s=Object(i.createStore)(function(e){return(t,n)=>n.type===r?Object.assign({},t,n.data):e(t,n)}(Object(i.combineReducers)(t)),n,e.addMessageListener&&Object(i.applyMiddleware)(d,u,l));return s._didRehydrate=!1,s._didRequestInitialState=!1,e.addMessageListener&&e.addMessageListener(o,e=>{try{s.dispatch(e.data)}catch(t){console.error("Content msg:",e,"Dispatch error: ",t),dump(`Content msg: ${JSON.stringify(e)}\nDispatch error: ${t}\n${t.stack}`)}}),s}}).call(this,n(5))},function(e,t){e.exports=PropTypes},function(e,t){e.exports=Redux},function(e,t,n){"use strict";var s=n(1);const i={history:{intlID:"type_label_visited",icon:"history-item"},bookmark:{intlID:"type_label_bookmarked",icon:"bookmark-added"},trending:{intlID:"type_label_recommended",icon:"trending"},now:{intlID:"type_label_now",icon:"now"},pocket:{intlID:"type_label_pocket",icon:"pocket"},download:{intlID:"type_label_downloaded",icon:"download"}};var r=n(3),a=n(2),o=n(20),c=n(19),l=n(0),d=n.n(l),u=n(7);n.d(t,"a",function(){return m}),n.d(t,"b",function(){return _});const p=new Map;class h extends d.a.PureComponent{constructor(e){super(e),this.state={activeCard:null,imageLoaded:!1,showContextMenu:!1,cardImage:null},this.onMenuButtonClick=this.onMenuButtonClick.bind(this),this.onMenuUpdate=this.onMenuUpdate.bind(this),this.onLinkClick=this.onLinkClick.bind(this)}maybeLoadImage(){var e=this;return function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(i,r){try{var a=t[i](r),o=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(o).then(function(e){s("next",e)},function(e){s("throw",e)});e(o)}("next")})}}(function*(){const{cardImage:t}=e.state;if(!t)return;const n=t.url;if(!e.state.imageLoaded){if(!p.has(n)){const e=new Promise(function(e,t){const s=new Image;s.addEventListener("load",e),s.addEventListener("error",t),s.src=n});p.set(n,e),e.catch(function(e){return e}).then(function(){return p.delete(n)}).catch()}yield p.get(n),u.a.isRemoteImageLocal(e.state.cardImage,e.props.link.image)&&!e.state.imageLoaded&&e.setState({imageLoaded:!0})}})()}static getNextStateFromProps(e,t){const{image:n}=e.link,s=u.a.isRemoteImageLocal(t.cardImage,n);let i=null;return!s&&e.link&&(i={imageLoaded:!1}),s?i:(u.a.maybeRevokeBlobObjectURL(t.cardImage),(i=i||{}).cardImage=u.a.createLocalImageObject(n),i)}onMenuButtonClick(e){e.preventDefault(),this.setState({activeCard:this.props.index,showContextMenu:!0})}_getTelemetryInfo(){return"history"!==this.props.link.type?{value:{card_type:this.props.link.type}}:null}onLinkClick(e){if(e.preventDefault(),"download"===this.props.link.type)this.props.dispatch(s.b.OnlyToMain({type:s.c.SHOW_DOWNLOAD_FILE,data:this.props.link}));else{const{altKey:t,button:n,ctrlKey:i,metaKey:r,shiftKey:a}=e;this.props.dispatch(s.b.OnlyToMain({type:s.c.OPEN_LINK,data:Object.assign(this.props.link,{event:{altKey:t,button:n,ctrlKey:i,metaKey:r,shiftKey:a}})}))}this.props.isWebExtension?this.props.dispatch(s.b.WebExtEvent(s.c.WEBEXT_CLICK,{source:this.props.eventSource,url:this.props.link.url,action_position:this.props.index})):(this.props.dispatch(s.b.UserEvent(Object.assign({event:"CLICK",source:this.props.eventSource,action_position:this.props.index},this._getTelemetryInfo()))),this.props.shouldSendImpressionStats&&this.props.dispatch(s.b.ImpressionStats({source:this.props.eventSource,click:0,tiles:[{id:this.props.link.guid,pos:this.props.index}]})))}onMenuUpdate(e){this.setState({showContextMenu:e})}componentDidMount(){this.maybeLoadImage()}componentDidUpdate(){this.maybeLoadImage()}componentWillMount(){const e=h.getNextStateFromProps(this.props,this.state);e&&this.setState(e)}componentWillReceiveProps(e){const t=h.getNextStateFromProps(e,this.state);t&&this.setState(t)}componentWillUnmount(){u.a.maybeRevokeBlobObjectURL(this.state.cardImage)}render(){const{index:e,className:t,link:n,dispatch:s,contextMenuOptions:r,eventSource:l,shouldSendImpressionStats:u}=this.props,{props:p}=this,h=this.state.showContextMenu&&this.state.activeCard===e,{icon:m,intlID:_}=i["now"===n.type?"trending":n.type]||{},E=this.state.cardImage||n.hasImage,f={backgroundImage:this.state.cardImage?`url(${this.state.cardImage.url})`:"none"},g=["card-outer",t,h&&"active",p.placeholder&&"placeholder"].filter(e=>e).join(" ");return d.a.createElement("li",{className:g},d.a.createElement("a",{href:"pocket"===n.type?n.open_url:n.url,onClick:p.placeholder?void 0:this.onLinkClick},d.a.createElement("div",{className:"card"},d.a.createElement("div",{className:"card-preview-image-outer"},E&&d.a.createElement("div",{className:`card-preview-image${this.state.imageLoaded?" loaded":""}`,style:f})),d.a.createElement("div",{className:"card-details"},"download"===n.type&&d.a.createElement("div",{className:"card-host-name alternate"},d.a.createElement(a.FormattedMessage,{id:Object(o.a)(this.props.platform)})),n.hostname&&d.a.createElement("div",{className:"card-host-name"},n.hostname.slice(0,100),"download"===n.type&&`  — ${n.description}`),d.a.createElement("div",{className:["card-text",m?"":"no-context",n.description?"":"no-description",n.hostname?"":"no-host-name"].join(" ")},d.a.createElement("h4",{className:"card-title",dir:"auto"},n.title),d.a.createElement("p",{className:"card-description",dir:"auto"},n.description)),d.a.createElement("div",{className:"card-context"},m&&!n.context&&d.a.createElement("span",{className:`card-context-icon icon icon-${m}`}),n.icon&&n.context&&d.a.createElement("span",{className:"card-context-icon icon",style:{backgroundImage:`url('${n.icon}')`}}),_&&!n.context&&d.a.createElement("div",{className:"card-context-label"},d.a.createElement(a.FormattedMessage,{id:_,defaultMessage:"Visited"})),n.context&&d.a.createElement("div",{className:"card-context-label"},n.context))))),!p.placeholder&&d.a.createElement("button",{className:"context-menu-button icon",onClick:this.onMenuButtonClick},d.a.createElement("span",{className:"sr-only"},`Open context menu for ${n.title}`)),h&&d.a.createElement(c.a,{dispatch:s,index:e,source:l,onUpdate:this.onMenuUpdate,options:n.contextMenuOptions||r,site:n,siteInfo:this._getTelemetryInfo(),shouldSendImpressionStats:u}))}}h.defaultProps={link:{}};const m=Object(r.connect)(e=>({platform:e.Prefs.values.platform}))(h),_=e=>d.a.createElement(m,{placeholder:!0,className:e.className})},function(e,t,n){"use strict";var s=n(0),i=n(22),r=n.n(i),a=n(10);class o{constructor(e){this.contexts=new a.a(e),this.subs=new Set}subscribe(e){this.subs.add(e)}unsubscribe(e){this.subs.delete(e)}setMessages(e){this.contexts=new a.a(e),this.subs.forEach(e=>e.relocalize())}getMessageContext(e){return Object(a.c)(this.contexts,e)}formatCompound(e,t,n){const s=e.format(t,n);if(t.attrs){var i={};for(const s of Object.keys(t.attrs))i[s]=e.format(t.attrs[s],n)}return{value:s,attrs:i}}getString(e,t,n){const s=this.getMessageContext(e);if(null===s)return n||e;const i=s.getMessage(e);return s.format(i,t)}}function c(e,t){return e[t]instanceof o?null:new Error(`The ${t} context field must be an instance of ReactLocalization.`)}class l extends s.Component{constructor(e){super(e);const{messages:t}=e;if(void 0===t)throw new Error("LocalizationProvider must receive the messages prop.");if(!t[Symbol.iterator])throw new Error("The messages prop must be an iterable.");this.l10n=new o(t)}getChildContext(){return{l10n:this.l10n}}componentWillReceiveProps(e){const{messages:t}=e;t!==this.props.messages&&this.l10n.setMessages(t)}render(){return s.Children.only(this.props.children)}}l.childContextTypes={l10n:c},l.propTypes={children:r.a.element.isRequired,messages:function(e,t,n){const s=e[t];if(Symbol.iterator in Object(s))return null;return new Error(`The ${t} prop supplied to ${n} must be an iterable.`)}};const d=document.createElement("template");var u={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},p=Object.assign({menuitem:!0},u);const h=/<|&#?\w+;/;class m extends s.Component{componentDidMount(){const{l10n:e}=this.context;e&&e.subscribe(this)}componentWillUnmount(){const{l10n:e}=this.context;e&&e.unsubscribe(this)}relocalize(){this.forceUpdate()}render(){const{l10n:e}=this.context,{id:t,attrs:n,children:i}=this.props,r=s.Children.only(i);if(!e)return r;const a=e.getMessageContext(t);if(null===a)return r;const o=a.getMessage(t),[c,l]=function(e){const t={},n={};for(const[i,r]of Object.entries(e))i.startsWith("$")?t[i.substr(1)]=r:Object(s.isValidElement)(r)&&(n[i.toLowerCase()]=r);return[t,n]}(this.props),{value:u,attrs:m}=e.formatCompound(a,o,c);if(n&&m){var _={};for(const[e,t]of Object.entries(m))n[e]&&(_[e]=t)}if(r.type in p)return Object(s.cloneElement)(r,_);if(null===u)return Object(s.cloneElement)(r,_);if(!h.test(u))return Object(s.cloneElement)(r,_,u);const E=Array.from(function(e){return d.innerHTML=e,d.content}(u).childNodes).map(e=>{if(e.nodeType===e.TEXT_NODE)return e.textContent;if(!l.hasOwnProperty(e.localName))return e.textContent;const t=l[e.localName];return t.type in p?t:Object(s.cloneElement)(t,null,e.textContent)});return Object(s.cloneElement)(r,_,...E)}}m.contextTypes={l10n:c},m.propTypes={children:r.a.element.isRequired},n.d(t,"a",function(){return l}),n.d(t,!1,function(){}),n.d(t,"b",function(){return m}),n.d(t,!1,function(){return o}),n.d(t,!1,function(){return c})},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});const s=e.document&&"about:newtab"===e.document.documentURI}).call(this,n(5))},function(e,t,n){"use strict";var s=n(1),i=n(2),r=n(0),a=n.n(r),o=n(4);class c extends a.a.PureComponent{constructor(e){super(e),this.state={validationError:this.props.validationError},this.onChange=this.onChange.bind(this),this.onMount=this.onMount.bind(this)}componentWillReceiveProps(e){e.shouldFocus&&!this.props.shouldFocus&&this.input.focus(),e.validationError&&!this.props.validationError&&this.setState({validationError:!0}),this.state.validationError&&!e.value&&this.setState({validationError:!1})}onChange(e){this.state.validationError&&this.setState({validationError:!1}),this.props.onChange(e)}onMount(e){this.input=e}render(){const e=this.props.value&&this.props.onClear,{typeUrl:t}=this.props,{validationError:n}=this.state;return a.a.createElement("label",null,a.a.createElement(i.FormattedMessage,{id:this.props.titleId}),a.a.createElement("div",{className:`field ${t?"url":""}${n?" invalid":""}`},this.props.loading?a.a.createElement("div",{className:"loading-container"},a.a.createElement("div",{className:"loading-animation"})):e&&a.a.createElement("div",{className:"icon icon-clear-input",onClick:this.props.onClear}),a.a.createElement("input",{type:"text",value:this.props.value,ref:this.onMount,onChange:this.onChange,placeholder:this.props.intl.formatMessage({id:this.props.placeholderId}),autoFocus:this.props.shouldFocus,disabled:this.props.loading}),n&&a.a.createElement("aside",{className:"error-tooltip"},a.a.createElement(i.FormattedMessage,{id:this.props.errorMessageId}))))}}c.defaultProps={showClearButton:!1,value:"",validationError:!1};var l=n(13);n.d(t,"a",function(){return d});class d extends a.a.PureComponent{constructor(e){super(e);const{site:t}=e;this.state={label:t?t.label||t.hostname:"",url:t?t.url:"",validationError:!1,customScreenshotUrl:t?t.customScreenshotURL:"",showCustomScreenshotForm:!!t&&t.customScreenshotURL},this.onClearScreenshotInput=this.onClearScreenshotInput.bind(this),this.onLabelChange=this.onLabelChange.bind(this),this.onUrlChange=this.onUrlChange.bind(this),this.onCancelButtonClick=this.onCancelButtonClick.bind(this),this.onClearUrlClick=this.onClearUrlClick.bind(this),this.onDoneButtonClick=this.onDoneButtonClick.bind(this),this.onCustomScreenshotUrlChange=this.onCustomScreenshotUrlChange.bind(this),this.onPreviewButtonClick=this.onPreviewButtonClick.bind(this),this.onEnableScreenshotUrlForm=this.onEnableScreenshotUrlForm.bind(this),this.validateUrl=this.validateUrl.bind(this)}onLabelChange(e){this.setState({label:e.target.value})}onUrlChange(e){this.setState({url:e.target.value,validationError:!1})}onClearUrlClick(){this.setState({url:"",validationError:!1})}onEnableScreenshotUrlForm(){this.setState({showCustomScreenshotForm:!0})}_updateCustomScreenshotInput(e){this.setState({customScreenshotUrl:e,validationError:!1}),this.props.dispatch({type:s.c.PREVIEW_REQUEST_CANCEL})}onCustomScreenshotUrlChange(e){this._updateCustomScreenshotInput(e.target.value)}onClearScreenshotInput(){this._updateCustomScreenshotInput("")}onCancelButtonClick(e){e.preventDefault(),this.props.onClose()}onDoneButtonClick(e){if(e.preventDefault(),this.validateForm()){const e={url:this.cleanUrl(this.state.url)},{index:t}=this.props;""!==this.state.label&&(e.label=this.state.label),this.state.customScreenshotUrl?e.customScreenshotURL=this.cleanUrl(this.state.customScreenshotUrl):this.props.site&&this.props.site.customScreenshotURL&&(e.customScreenshotURL=null),this.props.dispatch(s.b.AlsoToMain({type:s.c.TOP_SITES_PIN,data:{site:e,index:t}})),this.props.dispatch(s.b.UserEvent({source:o.d,event:"TOP_SITES_EDIT",action_position:t})),this.props.onClose()}}onPreviewButtonClick(e){e.preventDefault(),this.validateForm()&&(this.props.dispatch(s.b.AlsoToMain({type:s.c.PREVIEW_REQUEST,data:{url:this.cleanUrl(this.state.customScreenshotUrl)}})),this.props.dispatch(s.b.UserEvent({source:o.d,event:"PREVIEW_REQUEST"})))}cleanUrl(e){return e.startsWith("http:")||e.startsWith("https:")?e:`http://${e}`}_tryParseUrl(e){try{return new URL(e)}catch(e){return null}}validateUrl(e){const t=this._tryParseUrl(e)||this._tryParseUrl(this.cleanUrl(e));return t&&["http:","https:"].includes(t.protocol)}validateCustomScreenshotUrl(){const{customScreenshotUrl:e}=this.state;return!e||this.validateUrl(e)}validateForm(){const e=this.validateUrl(this.state.url)&&this.validateCustomScreenshotUrl();return e||this.setState({validationError:!0}),e}_renderCustomScreenshotInput(){const{customScreenshotUrl:e}=this.state,t=""===this.props.previewResponse,n=this.state.validationError&&!this.validateCustomScreenshotUrl()||t,s=n&&this.validateUrl(this.state.url)||!e,r=null===this.props.previewResponse&&e&&this.props.previewUrl===this.cleanUrl(e);return this.state.showCustomScreenshotForm?a.a.createElement("div",{className:"custom-image-input-container"},a.a.createElement(c,{errorMessageId:t?"topsites_form_image_validation":"topsites_form_url_validation",loading:r,onChange:this.onCustomScreenshotUrlChange,onClear:this.onClearScreenshotInput,shouldFocus:s,typeUrl:!0,value:e,validationError:n,titleId:"topsites_form_image_url_label",placeholderId:"topsites_form_url_placeholder",intl:this.props.intl})):a.a.createElement("a",{className:"enable-custom-image-input",onClick:this.onEnableScreenshotUrlForm},a.a.createElement(i.FormattedMessage,{id:"topsites_form_use_image_link"}))}render(){const{customScreenshotUrl:e}=this.state,t=""===this.props.previewResponse,n=!this.props.site,s=this.props.site&&this.props.site.customScreenshotURL||"",r=e&&this.cleanUrl(e)!==s&&!this.props.previewResponse,o=Object.assign({},this.props.site);return this.props.previewResponse&&(o.screenshot=this.props.previewResponse,o.customScreenshotURL=this.props.previewUrl),a.a.createElement("form",{className:"topsite-form"},a.a.createElement("div",{className:"form-input-container"},a.a.createElement("h3",{className:"section-title"},a.a.createElement(i.FormattedMessage,{id:n?"topsites_form_add_header":"topsites_form_edit_header"})),a.a.createElement("div",{className:"fields-and-preview"},a.a.createElement("div",{className:"form-wrapper"},a.a.createElement(c,{onChange:this.onLabelChange,value:this.state.label,titleId:"topsites_form_title_label",placeholderId:"topsites_form_title_placeholder",intl:this.props.intl}),a.a.createElement(c,{onChange:this.onUrlChange,shouldFocus:this.state.validationError&&!this.validateUrl(this.state.url),value:this.state.url,onClear:this.onClearUrlClick,validationError:this.state.validationError&&!this.validateUrl(this.state.url),titleId:"topsites_form_url_label",typeUrl:!0,placeholderId:"topsites_form_url_placeholder",errorMessageId:"topsites_form_url_validation",intl:this.props.intl}),this._renderCustomScreenshotInput()),a.a.createElement(l.a,{link:o,defaultStyle:t,title:this.state.label}))),a.a.createElement("section",{className:"actions"},a.a.createElement("button",{className:"cancel",type:"button",onClick:this.onCancelButtonClick},a.a.createElement(i.FormattedMessage,{id:"topsites_form_cancel_button"})),r?a.a.createElement("button",{className:"done preview",type:"submit",onClick:this.onPreviewButtonClick},a.a.createElement(i.FormattedMessage,{id:"topsites_form_preview_button"})):a.a.createElement("button",{className:"done",type:"submit",onClick:this.onDoneButtonClick},a.a.createElement(i.FormattedMessage,{id:n?"topsites_form_add_button":"topsites_form_save_button"}))))}}d.defaultProps={site:null,index:-1}},function(e,t,n){"use strict";var s=n(0),i=n.n(s);class r extends i.a.PureComponent{componentWillMount(){this.setState({active:!0}),document.body.classList.add("modal-open")}componentWillUnmount(){document.body.classList.remove("modal-open"),this.setState({active:!1})}render(){const{active:e}=this.state,{title:t,button_label:n}=this.props;return i.a.createElement("div",null,i.a.createElement("div",{className:`modalOverlayOuter ${e?"active":""}`}),i.a.createElement("div",{className:`modalOverlayInner ${e?"active":""}`},i.a.createElement("h2",null," ",t," "),this.props.children,i.a.createElement("div",{className:"footer"},i.a.createElement("button",{onClick:this.props.onDoneButton,className:"button primary modalButton"}," ",n," "))))}}n.d(t,"a",function(){return c});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e};class o extends i.a.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this)}onClick(){const{props:e}=this;e.sendUserActionTelemetry({event:"CLICK_BUTTON",message_id:e.id,id:e.UISurface}),e.onAction(e.content)}render(){const{content:e}=this.props;return i.a.createElement("div",{className:"onboardingMessage"},i.a.createElement("div",{className:`onboardingMessageImage ${e.icon}`}),i.a.createElement("div",{className:"onboardingContent"},i.a.createElement("span",null,i.a.createElement("h3",null," ",e.title," "),i.a.createElement("p",null," ",e.text," ")),i.a.createElement("span",null,i.a.createElement("button",{className:"button onboardingButton",onClick:this.onClick}," ",e.button_label," "))))}}class c extends i.a.PureComponent{render(){const{props:e}=this;return i.a.createElement(r,a({},e,{button_label:"Start Browsing",title:"Welcome to Firefox"}),i.a.createElement("div",{className:"onboardingMessageContainer"},e.bundle.map(t=>i.a.createElement(o,a({key:t.id,sendUserActionTelemetry:e.sendUserActionTelemetry,onAction:e.onAction,UISurface:e.UISurface},t)))))}}},function(e,t,n){"use strict";var s=n(0),i=n.n(s),r=n(8);const a=["color","backgroundColor"],o=e=>{const t={};for(const n of a)void 0!==e[n]&&(t[n]=e[n]);return t.backgroundColor&&(t.border="0"),i.a.createElement("a",{href:Object(r.a)(e.url),onClick:e.onClick,className:e.className||"ASRouterButton",style:t},e.children)};class c extends i.a.PureComponent{constructor(e){super(e),this.onBlockClicked=this.onBlockClicked.bind(this)}onBlockClicked(){this.props.sendUserActionTelemetry({event:"BLOCK",id:this.props.UISurface}),this.props.onBlock()}render(){const{props:e}=this,t=`SnippetBaseContainer${e.className?` ${e.className}`:""}`;return i.a.createElement("div",{className:t},i.a.createElement("div",{className:"innerWrapper"},e.children),i.a.createElement("button",{className:"blockButton",onClick:this.onBlockClicked}))}}n.d(t,"a",function(){return u});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e};const d="chrome://branding/content/icon64.png";class u extends i.a.PureComponent{constructor(e){super(e),this.onButtonClick=this.onButtonClick.bind(this)}onButtonClick(){this.props.sendUserActionTelemetry({event:"CLICK_BUTTON",id:this.props.UISurface})}renderTitle(){const{title:e}=this.props.content;return e?i.a.createElement("h3",{className:"title"},e):null}renderTitleIcon(){const e=Object(r.a)(this.props.content.title_icon);return e?i.a.createElement("span",{className:"titleIcon",style:{backgroundImage:`url("${e}")`}}):null}renderButton(e){const{props:t}=this;return i.a.createElement(o,{className:e,onClick:this.onButtonClick,url:t.content.button_url,color:t.content.button_color,backgroundColor:t.content.button_background_color},t.content.button_label)}render(){const{props:e}=this,t=e.content.button_url&&"anchor"===e.content.button_type,n=e.content.button_url&&!e.content.button_type,s=`SimpleSnippet${e.content.tall?" tall":""}`;return i.a.createElement(c,l({},e,{className:s}),i.a.createElement("img",{src:Object(r.a)(e.content.icon)||d,className:"icon"}),i.a.createElement("div",null,this.renderTitleIcon()," ",this.renderTitle()," ",i.a.createElement("p",{className:"body"},e.richText||e.content.text)," ",t?this.renderButton("ASRouterAnchor"):null),n?i.a.createElement("div",null,this.renderButton()):null)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return o});var s=n(1),i=n(14);const r="visible",a="visibilitychange";class o{constructor(t,n={}){this._store=t,this.document=n.document||e.document,this._perfService=n.perfService||i.a,this._onVisibilityChange=this._onVisibilityChange.bind(this)}sendEventOrAddListener(){this.document.visibilityState===r?this._sendEvent():this.document.addEventListener(a,this._onVisibilityChange)}_sendEvent(){this._perfService.mark("visibility_event_rcvd_ts");try{let e=this._perfService.getMostRecentAbsMarkStartByName("visibility_event_rcvd_ts");this._store.dispatch(s.b.AlsoToMain({type:s.c.SAVE_SESSION_PERF_DATA,data:{visibility_event_rcvd_ts:e}}))}catch(e){}}_onVisibilityChange(){this.document.visibilityState===r&&(this._sendEvent(),this.document.removeEventListener(a,this._onVisibilityChange))}}}).call(this,n(5))},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var s=n(1),i=n(2),r=n(3),a=n(0),o=n.n(a);const c=Object(r.connect)(e=>({fxa_endpoint:e.Prefs.values.fxa_endpoint}))(Object(i.injectIntl)(class extends o.a.PureComponent{constructor(e){super(e),this.onInputChange=this.onInputChange.bind(this),this.onSubmit=this.onSubmit.bind(this),this.clickSkip=this.clickSkip.bind(this),this.initScene=this.initScene.bind(this),this.removeOverlay=this.removeOverlay.bind(this),this.state={emailInput:"",overlayRemoved:!1,flowId:"",flowBeginTime:0},this.didFetch=!1}componentWillUpdate(){var e=this;return function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(i,r){try{var a=t[i](r),o=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(o).then(function(e){s("next",e)},function(e){s("throw",e)});e(o)}("next")})}}(function*(){if(e.props.fxa_endpoint&&!e.didFetch)try{e.didFetch=!0;const t=yield fetch(`${e.props.fxa_endpoint}/metrics-flow`);if(200===t.status){const{flowId:n,flowBeginTime:s}=yield t.json();e.setState({flowId:n,flowBeginTime:s})}}catch(t){e.props.dispatch(s.b.OnlyToMain({type:s.c.TELEMETRY_UNDESIRED_EVENT,data:{value:"FXA_METRICS_ERROR"}}))}})()}componentDidMount(){this.initScene()}initScene(){setTimeout(()=>{this.setState({show:!0})},10)}removeOverlay(){window.removeEventListener("visibilitychange",this.removeOverlay),this.setState({show:!1}),setTimeout(()=>{document.body.classList.remove("welcome"),this.setState({overlayRemoved:!0})},400)}onInputChange(e){this.setState({emailInput:e.target.value})}onSubmit(){this.props.dispatch(s.b.UserEvent({event:"SUBMIT_EMAIL"})),window.addEventListener("visibilitychange",this.removeOverlay)}clickSkip(){this.props.dispatch(s.b.UserEvent({event:"SKIPPED_SIGNIN"})),this.removeOverlay()}render(){if(this.state.overlayRemoved)return null;let e=o.a.createElement("a",{href:`${this.props.fxa_endpoint}/legal/terms`,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(i.FormattedMessage,{id:"firstrun_terms_of_service"})),t=o.a.createElement("a",{href:`${this.props.fxa_endpoint}/legal/privacy`,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(i.FormattedMessage,{id:"firstrun_privacy_notice"}));return o.a.createElement("div",{className:`overlay-wrapper ${this.state.show?"show ":""}`},o.a.createElement("div",{className:"background"}),o.a.createElement("div",{className:"firstrun-scene"},o.a.createElement("div",{className:"fxaccounts-container"},o.a.createElement("div",{className:"firstrun-left-divider"},o.a.createElement("h1",{className:"firstrun-title"},o.a.createElement(i.FormattedMessage,{id:"firstrun_title"})),o.a.createElement("p",{className:"firstrun-content"},o.a.createElement(i.FormattedMessage,{id:"firstrun_content"})),o.a.createElement("a",{className:"firstrun-link",href:"https://www.mozilla.org/firefox/features/sync/",target:"_blank",rel:"noopener noreferrer"},o.a.createElement(i.FormattedMessage,{id:"firstrun_learn_more_link"}))),o.a.createElement("div",{className:"firstrun-sign-in"},o.a.createElement("p",{className:"form-header"},o.a.createElement(i.FormattedMessage,{id:"firstrun_form_header"}),o.a.createElement("span",{className:"sub-header"},o.a.createElement(i.FormattedMessage,{id:"firstrun_form_sub_header"}))),o.a.createElement("form",{method:"get",action:this.props.fxa_endpoint,target:"_blank",rel:"noopener noreferrer",onSubmit:this.onSubmit},o.a.createElement("input",{name:"service",type:"hidden",value:"sync"}),o.a.createElement("input",{name:"action",type:"hidden",value:"email"}),o.a.createElement("input",{name:"context",type:"hidden",value:"fx_desktop_v3"}),o.a.createElement("input",{name:"entrypoint",type:"hidden",value:"activity-stream-firstrun"}),o.a.createElement("input",{name:"utm_source",type:"hidden",value:"activity-stream"}),o.a.createElement("input",{name:"utm_campaign",type:"hidden",value:"firstrun"}),o.a.createElement("input",{name:"flow_id",type:"hidden",value:this.state.flowId}),o.a.createElement("input",{name:"flow_begin_time",type:"hidden",value:this.state.flowBeginTime}),o.a.createElement("input",{className:"email-input",name:"email",type:"email",required:"true",placeholder:this.props.intl.formatMessage({id:"firstrun_email_input_placeholder"}),onChange:this.onInputChange}),o.a.createElement("div",{className:"extra-links"},o.a.createElement(i.FormattedMessage,{id:"firstrun_extra_legal_links",values:{terms:e,privacy:t}})),o.a.createElement("button",{className:"continue-button",type:"submit"},o.a.createElement(i.FormattedMessage,{id:"firstrun_continue_to_login"}))),o.a.createElement("button",{className:"skip-button",disabled:!!this.state.emailInput,onClick:this.clickSkip},o.a.createElement(i.FormattedMessage,{id:"firstrun_skip_login"}))))))}}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return E});var s=n(1),i=n(4),r=n(17),a=n(15),o=n(3),c=n(2),l=n(0),d=n.n(l),u=n(9),p=n(27),h=n(13),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e};function _(e){return e.customScreenshotURL?"custom_screenshot":e.tippyTopIcon||"tippytop"===e.faviconRef?"tippytop":e.faviconSize>=i.b?"rich_icon":e.screenshot&&e.faviconSize>=i.a?"screenshot_with_icon":e.screenshot?"screenshot":"no_image"}const E=Object(o.connect)(e=>({TopSites:e.TopSites,Prefs:e.Prefs,TopSitesRows:e.Prefs.values.topSitesRows}))(Object(c.injectIntl)(class extends d.a.PureComponent{constructor(e){super(e),this.onFormClose=this.onFormClose.bind(this)}_dispatchTopSitesStats(){const e=this._getVisibleTopSites(),t=function(e){return e.reduce((e,t)=>(e[_(t)]++,e),{custom_screenshot:0,screenshot_with_icon:0,screenshot:0,tippytop:0,rich_icon:0,no_image:0})}(e),n=e.filter(e=>!!e.isPinned).length;this.props.dispatch(s.b.AlsoToMain({type:s.c.SAVE_SESSION_PERF_DATA,data:{topsites_icon_stats:t,topsites_pinned:n}}))}_getVisibleTopSites(){let t=u.a;return e.matchMedia("(min-width: 1072px)").matches||(t-=2),this.props.TopSites.rows.slice(0,this.props.TopSitesRows*t)}componentDidUpdate(){this._dispatchTopSitesStats()}componentDidMount(){this._dispatchTopSitesStats()}onFormClose(){this.props.dispatch(s.b.UserEvent({source:i.d,event:"TOP_SITES_EDIT_CLOSE"})),this.props.dispatch({type:s.c.TOP_SITES_CANCEL_EDIT})}render(){const{props:e}=this,{editForm:t}=e.TopSites;return d.a.createElement(a.a,{id:"topsites",initialized:e.TopSites.initialized,dispatch:e.dispatch},d.a.createElement(r.a,{className:"top-sites",icon:"topsites",id:"topsites",title:{id:"header_top_sites"},extraMenuOptions:["AddTopSite"],showPrefName:"feeds.topsites",eventSource:i.d,collapsed:e.TopSites.pref?e.TopSites.pref.collapsed:void 0,isFirst:e.isFirst,isLast:e.isLast,dispatch:e.dispatch},d.a.createElement(h.b,{TopSites:e.TopSites,TopSitesRows:e.TopSitesRows,dispatch:e.dispatch,intl:e.intl,topSiteIconType:_}),d.a.createElement("div",{className:"edit-topsites-wrapper"},t&&d.a.createElement("div",{className:"edit-topsites"},d.a.createElement("div",{className:"modal-overlay",onClick:this.onFormClose}),d.a.createElement("div",{className:"modal"},d.a.createElement(p.a,m({site:e.TopSites.rows[t.index],onClose:this.onFormClose,dispatch:this.props.dispatch,intl:this.props.intl},t)))))))}}))}).call(this,n(5))},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var s=n(2),i=n(0),r=n.n(i);class a extends r.a.PureComponent{render(){const{url:e,name:t}=this.props;return r.a.createElement("li",null,r.a.createElement("a",{key:t,className:"topic-link",href:e},t))}}class o extends r.a.PureComponent{render(){const{topics:e,read_more_endpoint:t}=this.props;return r.a.createElement("div",{className:"topic"},r.a.createElement("span",null,r.a.createElement(s.FormattedMessage,{id:"pocket_read_more"})),r.a.createElement("ul",null,e&&e.map(e=>r.a.createElement(a,{key:e.name,url:e.url,name:e.name}))),t&&r.a.createElement("a",{className:"topic-read-more",href:t},r.a.createElement(s.FormattedMessage,{id:"pocket_read_even_more"})))}}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var s=n(1),i=n(18),r=n(2),a=n(0),o=n.n(a),c=n(16);const l=["MoveUp","MoveDown","Separator","RemoveSection","CheckCollapsed","Separator","ManageSection"],d=["MoveUp","MoveDown","Separator","CheckCollapsed","Separator","ManageWebExtension"];const u=Object(r.injectIntl)(class extends o.a.PureComponent{getOptions(){const{props:e}=this,t=e.isWebExtension?[...d]:[...l];e.extraOptions&&t.splice(0,0,...e.extraOptions,"Separator"),e.privacyNoticeURL&&t.splice(-1,0,"PrivacyNotice");const n=t.map(t=>c.a[t](e)).map(t=>{const{action:n,id:i,type:r,userEvent:a}=t;return!r&&i&&(t.label=e.intl.formatMessage({id:i}),t.onClick=(()=>{e.dispatch(n),a&&e.dispatch(s.b.UserEvent({event:a,source:e.source}))})),t});return n[0].first=!0,n[n.length-1].last=!0,n}render(){return o.a.createElement(i.a,{onUpdate:this.props.onUpdate,options:this.getOptions()})}})},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return v});var s=n(24),i=n(2),r=n(1),a=n(17),o=n(15),c=n(3),l=n(0),d=n.n(l),u=n(33),p=n(32),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e};const m="visible",_="visibilitychange",E=3,f=4;class g extends d.a.PureComponent{get numRows(){const{rowsPref:e,maxRows:t,Prefs:n}=this.props;return e?n.values[e]:t}_dispatchImpressionStats(){const{props:t}=this;let n=E;t.compactCards&&e.matchMedia("(min-width: 1072px)").matches&&(n=f);const s=n*this.numRows,i=t.rows.slice(0,s);this.needsImpressionStats(i)&&(t.dispatch(r.b.ImpressionStats({source:t.eventSource,tiles:i.map(e=>({id:e.guid}))})),this.impressionCardGuids=i.map(e=>e.guid))}sendImpressionStatsOrAddListener(){const{props:e}=this;e.shouldSendImpressionStats&&e.dispatch&&(e.document.visibilityState===m?this._dispatchImpressionStats():(this._onVisibilityChange&&e.document.removeEventListener(_,this._onVisibilityChange),this._onVisibilityChange=(()=>{e.document.visibilityState===m&&(this.props.pref.collapsed||this._dispatchImpressionStats(),e.document.removeEventListener(_,this._onVisibilityChange))}),e.document.addEventListener(_,this._onVisibilityChange)))}componentDidMount(){this.props.rows.length&&!this.props.pref.collapsed&&this.sendImpressionStatsOrAddListener()}componentDidUpdate(e){const{props:t}=this,n=t.pref.collapsed,s=e.pref.collapsed;t.rows.length&&(t.rows!==e.rows&&!n||s&&!n)&&this.sendImpressionStatsOrAddListener()}componentWillUnmount(){this._onVisibilityChange&&this.props.document.removeEventListener(_,this._onVisibilityChange)}needsImpressionStats(e){if(!this.impressionCardGuids||this.impressionCardGuids.length!==e.length)return!0;for(let t=0;t<e.length;t++)if(e[t].guid!==this.impressionCardGuids[t])return!0;return!1}render(){const{id:e,eventSource:t,title:n,icon:r,rows:c,emptyState:l,dispatch:p,compactCards:h,contextMenuOptions:m,initialized:_,disclaimer:g,pref:b,privacyNoticeURL:v,isFirst:S,isLast:y}=this.props,T=h?f:E,{numRows:O}=this,C=T*O,k=E*O,I="topstories"===e&&(!this.props.topics||this.props.topics.length>0),N=c.slice(0,C),x=_&&!c.length,w=[];if(!x)for(let e=0;e<C;e++){const n=N[e],i=e>=k?"hide-for-narrow":"";w.push(n?d.a.createElement(s.a,{key:e,index:e,className:i,dispatch:p,link:n,contextMenuOptions:m,eventSource:t,shouldSendImpressionStats:this.props.shouldSendImpressionStats,isWebExtension:this.props.isWebExtension}):d.a.createElement(s.b,{key:e,className:i}))}const M=["section",h?"compact-cards":"normal-cards"].join(" ");return d.a.createElement(o.a,this.props,d.a.createElement(a.a,{className:M,icon:r,title:n,id:e,eventSource:t,disclaimer:g,collapsed:this.props.pref.collapsed,showPrefName:b&&b.feed||e,privacyNoticeURL:v,Prefs:this.props.Prefs,isFirst:S,isLast:y,dispatch:this.props.dispatch,isWebExtension:this.props.isWebExtension},!x&&d.a.createElement("ul",{className:"section-list",style:{padding:0}},w),x&&d.a.createElement("div",{className:"section-empty-state"},d.a.createElement("div",{className:"empty-state"},l.icon&&l.icon.startsWith("moz-extension://")?d.a.createElement("img",{className:"empty-state-icon icon",style:{"background-image":`url('${l.icon}')`}}):d.a.createElement("img",{className:`empty-state-icon icon icon-${l.icon}`}),d.a.createElement("p",{className:"empty-state-message"},function(e){return"string"==typeof e?d.a.createElement("span",null,e):d.a.createElement(i.FormattedMessage,e)}(l.message)))),I&&d.a.createElement(u.a,{topics:this.props.topics,read_more_endpoint:this.props.read_more_endpoint})))}}g.defaultProps={document:e.document,rows:[],emptyState:{},pref:{},title:""};const b=Object(c.connect)(e=>({Prefs:e.Prefs}))(Object(i.injectIntl)(g));const v=Object(c.connect)(e=>({Sections:e.Sections,Prefs:e.Prefs}))(class extends d.a.PureComponent{renderSections(){const e=[],t=this.props.Sections.filter(e=>e.enabled),{sectionOrder:n,"feeds.topsites":s}=this.props.Prefs.values,i=t.length+~~s;for(const r of n.split(",")){const n={key:r,isFirst:0===e.length,isLast:e.length===i-1};if("topsites"===r&&s)e.push(d.a.createElement(p.a,n));else{const s=t.find(e=>e.id===r);s&&e.push(d.a.createElement(b,h({},s,n)))}}return e}render(){return d.a.createElement("div",{className:"sections-list"},this.renderSections())}})}).call(this,n(5))},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var s=n(2),i=n(1),r=n(3),a=n(26),o=n(0),c=n.n(o);const l=Object(r.connect)()(Object(s.injectIntl)(class extends c.a.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this),this.onInputMount=this.onInputMount.bind(this)}handleEvent(e){"Search"===e.detail.type&&this.props.dispatch(i.b.UserEvent({event:"SEARCH"}))}onClick(e){window.gContentSearchController.search(e)}componentWillUnmount(){delete window.gContentSearchController}onInputMount(e){if(e){const t=a.a?"newtab":"abouthome",n=a.a?"newtab":"homepage";window.gContentSearchController=new ContentSearchUIController(e,e.parentNode,t,n),addEventListener("ContentSearchClient",this)}else window.gContentSearchController=null,removeEventListener("ContentSearchClient",this)}render(){return c.a.createElement("div",{className:"search-wrapper"},c.a.createElement("label",{htmlFor:"newtab-search-text",className:"search-label"},c.a.createElement("span",{className:"sr-only"},c.a.createElement(s.FormattedMessage,{id:"search_web_placeholder"}))),c.a.createElement("input",{id:"newtab-search-text",maxLength:"256",placeholder:this.props.intl.formatMessage({id:"search_web_placeholder"}),ref:this.onInputMount,title:this.props.intl.formatMessage({id:"search_web_placeholder"}),type:"search"}),c.a.createElement("button",{id:"searchSubmit",className:"search-button",onClick:this.onClick,title:this.props.intl.formatMessage({id:"search_button"})},c.a.createElement("span",{className:"sr-only"},c.a.createElement(s.FormattedMessage,{id:"search_button"}))))}}))},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var s=new class{constructor(e){this.initialPrefs=e.initialPrefs,this.initialSections=e.initialSections,this._setValidation(e.validation)}get validation(){return this._validation}set validation(e){this._setValidation(e)}get invalidatingPrefs(){return this._invalidatingPrefs}_setValidation(e=[]){this._validation=e,this._invalidatingPrefs=e.reduce((e,t)=>{if("string"==typeof t)return e.push(t),e;if(t&&t.oneOf)return e.concat(t.oneOf);if(t&&t.indexedDB)return e.concat(t.indexedDB);throw new Error("Your validation configuration is not properly configured")},[])}arePrefsValid(e,t){for(const n of this.validation){if(n&&n.oneOf&&!n.oneOf.some(t=>e(t)===this.initialPrefs[t]))return!1;if(t&&n&&n.indexedDB){if(n.indexedDB.some(e=>t.some(t=>t&&t[e])))return!1}else if(e(n)!==this.initialPrefs[n])return!1}return!0}}({initialPrefs:{migrationExpired:!0,"feeds.topsites":!0,showSearch:!0,topSitesRows:1,"feeds.section.topstories":!0,"feeds.section.highlights":!0,sectionOrder:"topsites,topstories,highlights",collapsed:!1},validation:["feeds.topsites","showSearch","topSitesRows","sectionOrder",{oneOf:["feeds.section.topstories","feeds.section.highlights"]},{indexedDB:["collapsed"]}],initialSections:[{enabled:!0,icon:"pocket",id:"topstories",order:1,title:{id:"header_recommended_by",values:{provider:"Pocket"}}},{enabled:!0,id:"highlights",icon:"highlights",order:2,title:{id:"header_highlights"}}]})},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var s=n(1),i=n(3),r=n(2),a=n(0),o=n.n(a);const c=Object(i.connect)()(class extends o.a.PureComponent{constructor(e){super(e),this.onLaunchTour=this.onLaunchTour.bind(this),this.onCancelTour=this.onCancelTour.bind(this)}onLaunchTour(){this.props.dispatch(s.b.AlsoToMain({type:s.c.MIGRATION_START})),this.props.dispatch(s.b.UserEvent({event:s.c.MIGRATION_START}))}onCancelTour(){this.props.dispatch(s.b.AlsoToMain({type:s.c.MIGRATION_CANCEL})),this.props.dispatch(s.b.UserEvent({event:s.c.MIGRATION_CANCEL}))}render(){return o.a.createElement("div",{className:"manual-migration-container"},o.a.createElement("p",null,o.a.createElement("span",{className:"icon icon-import"}),o.a.createElement(r.FormattedMessage,{id:"manual_migration_explanation2"})),o.a.createElement("div",{className:"manual-migration-actions actions"},o.a.createElement("button",{className:"dismiss",onClick:this.onCancelTour},o.a.createElement(r.FormattedMessage,{id:"manual_migration_cancel_button"})),o.a.createElement("button",{onClick:this.onLaunchTour},o.a.createElement(r.FormattedMessage,{id:"manual_migration_import_button"}))))}})},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var s=n(1),i=n(3),r=n(2),a=n(0),o=n.n(a);const c=Object(i.connect)(e=>e.Dialog)(class extends o.a.PureComponent{constructor(e){super(e),this._handleCancelBtn=this._handleCancelBtn.bind(this),this._handleConfirmBtn=this._handleConfirmBtn.bind(this)}_handleCancelBtn(){this.props.dispatch({type:s.c.DIALOG_CANCEL}),this.props.dispatch(s.b.UserEvent({event:s.c.DIALOG_CANCEL,source:this.props.data.eventSource}))}_handleConfirmBtn(){this.props.data.onConfirm.forEach(this.props.dispatch)}_renderModalMessage(){const e=this.props.data.body_string_id;return e?o.a.createElement("span",null,e.map(e=>o.a.createElement("p",{key:e},o.a.createElement(r.FormattedMessage,{id:e})))):null}render(){return this.props.visible?o.a.createElement("div",{className:"confirmation-dialog"},o.a.createElement("div",{className:"modal-overlay",onClick:this._handleCancelBtn}),o.a.createElement("div",{className:"modal"},o.a.createElement("section",{className:"modal-message"},this.props.data.icon&&o.a.createElement("span",{className:`icon icon-spacer icon-${this.props.data.icon}`}),this._renderModalMessage()),o.a.createElement("section",{className:"actions"},o.a.createElement("button",{onClick:this._handleCancelBtn},o.a.createElement(r.FormattedMessage,{id:this.props.data.cancel_button_string_id})),o.a.createElement("button",{className:"done",onClick:this._handleConfirmBtn},o.a.createElement(r.FormattedMessage,{id:this.props.data.confirm_button_string_id}))))):null}})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var s=n(6),i=n(0),r=n.n(i);class a extends r.a.PureComponent{constructor(e){super(e),this.onMessage=this.onMessage.bind(this),this.findOtherBundledMessagesOfSameTemplate=this.findOtherBundledMessagesOfSameTemplate.bind(this),this.state={}}onMessage({data:e}){"ADMIN_SET_STATE"===e.type&&this.setState(e.data)}componentWillMount(){s.b.sendMessage({type:"ADMIN_CONNECT_STATE"}),s.b.addListener(this.onMessage)}componentWillUnmount(){s.b.removeListener(this.onMessage)}findOtherBundledMessagesOfSameTemplate(e){return this.state.messages.filter(t=>t.template===e&&t.bundled)}handleBlock(e){if(e.bundled){let t=this.findOtherBundledMessagesOfSameTemplate(e.template);return()=>s.b.blockBundle(t)}return()=>s.b.blockById(e.id)}handleUnblock(e){if(e.bundled){let t=this.findOtherBundledMessagesOfSameTemplate(e.template);return()=>s.b.unblockBundle(t)}return()=>s.b.unblockById(e.id)}handleOverride(e){return()=>s.b.overrideMessage(e)}renderMessageItem(e){const t=e.id===this.state.lastMessageId,n=this.state.blockList.includes(e.id);let s="message-item";return t&&(s+=" current"),n&&(s+=" blocked"),r.a.createElement("tr",{className:s,key:e.id},r.a.createElement("td",{className:"message-id"},r.a.createElement("span",null,e.id)),r.a.createElement("td",null,r.a.createElement("button",{className:`button ${n?"":" primary"}`,onClick:n?this.handleUnblock(e):this.handleBlock(e)},n?"Unblock":"Block"),n?null:r.a.createElement("button",{className:"button",onClick:this.handleOverride(e.id)},"Show")),r.a.createElement("td",{className:"message-summary"},r.a.createElement("pre",null,JSON.stringify(e,null,2))))}renderMessages(){return this.state.messages?r.a.createElement("table",null,r.a.createElement("tbody",null,this.state.messages.map(e=>this.renderMessageItem(e)))):null}renderProviders(){return r.a.createElement("table",null,r.a.createElement("tbody",null,this.state.providers.map((e,t)=>r.a.createElement("tr",{className:"message-item",key:t},r.a.createElement("td",null,e.id),r.a.createElement("td",null,"remote"===e.type?r.a.createElement("a",{target:"_blank",href:e.url},e.url):"(local)")))))}render(){return r.a.createElement("div",{className:"asrouter-admin outer-wrapper"},r.a.createElement("h1",null,"AS Router Admin"),r.a.createElement("button",{className:"button primary",onClick:s.b.getNextMessage},"Refresh Current Message"),r.a.createElement("h2",null,"Message Providers"),this.state.providers?this.renderProviders():null,r.a.createElement("h2",null,"Messages"),this.renderMessages())}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return g});var s=n(1),i=n(2),r=n(40),a=n(39),o=n(3),c=n(11),l=n(38),d=n(37),u=n(0),p=n.n(u),h=n(36),m=n(35),_=n(31);const E=Object(i.injectIntl)(e=>p.a.createElement("div",{className:"prefs-button"},p.a.createElement("button",{className:"icon icon-settings",onClick:e.onClick,title:e.intl.formatMessage({id:"settings_pane_button_label"})})));class f extends p.a.PureComponent{constructor(e){super(e),this.openPreferences=this.openPreferences.bind(this)}openPreferences(){this.props.dispatch(s.b.OnlyToMain({type:s.c.SETTINGS_OPEN})),this.props.dispatch(s.b.UserEvent({event:"OPEN_NEWTAB_PREFS"}))}render(){const{props:e}=this,{App:t}=e,{initialized:n}=t,s=e.Prefs.values,i=["outer-wrapper",d.a.arePrefsValid(e=>s[e])&&"fixed-to-top"].filter(e=>e).join(" ");return p.a.createElement("div",null,p.a.createElement("div",{className:i},p.a.createElement("main",null,s.showSearch&&p.a.createElement("div",{className:"non-collapsible-section"},p.a.createElement(c.a,null,p.a.createElement(h.a,null))),p.a.createElement("div",{className:`body-wrapper${n?" on":""}`},!s.migrationExpired&&p.a.createElement("div",{className:"non-collapsible-section"},p.a.createElement(l.a,null)),p.a.createElement(m.a,null),p.a.createElement(E,{onClick:this.openPreferences})),p.a.createElement(a.a,null))),this.props.isFirstrun&&p.a.createElement(_.a,null))}}const g=Object(o.connect)(e=>({App:e.App,Prefs:e.Prefs,Theme:e.Theme}))(class extends p.a.PureComponent{componentWillMount(){const{App:t,locale:n,Theme:s}=this.props;s.className&&this.updateTheme(s),this.sendNewTabRehydrated(t),function(e){Object(i.addLocaleData)([{locale:e,parentLocale:"en"}])}(n),this.props.isFirstrun&&e.document.body.classList.add("welcome")}componentDidMount(){this.props.isPrerendered&&(this.props.dispatch(s.b.AlsoToMain({type:s.c.NEW_TAB_STATE_REQUEST})),this.props.dispatch(s.b.AlsoToMain({type:s.c.PAGE_PRERENDERED})))}componentWillUnmount(){this.updateTheme({className:""})}componentWillUpdate({App:e,Theme:t}){this.updateTheme(t),this.sendNewTabRehydrated(e)}updateTheme(t){const n=["activity-stream",document.body.classList.contains("welcome")?"welcome":"",t.className].filter(e=>e).join(" ");e.document.body.className=n}sendNewTabRehydrated(e){e&&e.initialized&&!this.renderNotified&&(this.props.dispatch(s.b.AlsoToMain({type:s.c.NEW_TAB_REHYDRATED,data:{}})),this.renderNotified=!0)}render(){const{props:t}=this,{App:n,locale:s,strings:a}=t,{initialized:o}=n,l=t.Prefs.values;return(l.asrouterExperimentEnabled||l.asrouterOnboardingCohort>0)&&"#asrouter"===window.location.hash?p.a.createElement(r.a,null):t.isPrerendered||o?(l.asrouterOnboardingCohort>0&&e.document.body.classList.add("hide-onboarding"),p.a.createElement(i.IntlProvider,{locale:s,messages:a},p.a.createElement(c.a,{className:"base-content-fallback"},p.a.createElement(f,this.props)))):null}})}).call(this,n(5))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return o});var s=n(0),i=n.n(s);const r="visible",a="visibilitychange";class o extends i.a.PureComponent{sendImpressionOrAddListener(){this.props.document.visibilityState===r?this.props.sendImpression({id:this.props.id}):(this._onVisibilityChange&&this.props.document.removeEventListener(a,this._onVisibilityChange),this._onVisibilityChange=(()=>{this.props.document.visibilityState===r&&(this.props.sendImpression({id:this.props.id}),this.props.document.removeEventListener(a,this._onVisibilityChange))}),this.props.document.addEventListener(a,this._onVisibilityChange))}componentWillUnmount(){this._onVisibilityChange&&this.props.document.removeEventListener(a,this._onVisibilityChange)}componentDidMount(){this.props.sendOnMount&&this.sendImpressionOrAddListener()}componentDidUpdate(e){this.props.shouldSendImpressionOnUpdate(this.props,e)&&this.sendImpressionOrAddListener()}render(){return this.props.children}}o.defaultProps={document:e.document,sendOnMount:!0}}).call(this,n(5))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return m});var s=n(1),i=n(6);function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(i,r){try{var a=t[i](r),o=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(o).then(function(e){s("next",e)},function(e){s("throw",e)});e(o)}("next")})}}const a="snippets_db",o=1,c="snippets",l=144e5,d="Snippets:Enabled",u="Snippets:Disabled";class p extends Map{constructor(e){super(),this._db=null,this._dispatch=e}set(e,t){return super.set(e,t),this._dbTransaction(n=>n.put(t,e))}delete(e){return super.delete(e),this._dbTransaction(t=>t.delete(e))}clear(){return super.clear(),this._dispatch(s.b.OnlyToMain({type:s.c.SNIPPETS_BLOCKLIST_CLEARED})),this._dbTransaction(e=>e.clear())}get blockList(){return this.get("blockList")||[]}blockSnippetById(e){var t=this;return r(function*(){if(!e)return;const{blockList:n}=t;n.includes(e)||(n.push(e),t._dispatch(s.b.AlsoToMain({type:s.c.SNIPPETS_BLOCKLIST_UPDATED,data:e})),yield t.set("blockList",n))})()}disableOnboarding(){this._dispatch(s.b.AlsoToMain({type:s.c.DISABLE_ONBOARDING}))}showFirefoxAccounts(){this._dispatch(s.b.AlsoToMain({type:s.c.SHOW_FIREFOX_ACCOUNTS}))}getTotalBookmarksCount(){return new Promise(t=>{this._dispatch(s.b.OnlyToMain({type:s.c.TOTAL_BOOKMARKS_REQUEST})),e.addMessageListener("ActivityStream:MainToContent",function n({data:i}){i.type===s.c.TOTAL_BOOKMARKS_RESPONSE&&(t(i.data),e.removeMessageListener("ActivityStream:MainToContent",n))})})}getAddonsInfo(){return new Promise(t=>{this._dispatch(s.b.OnlyToMain({type:s.c.ADDONS_INFO_REQUEST})),e.addMessageListener("ActivityStream:MainToContent",function n({data:i}){i.type===s.c.ADDONS_INFO_RESPONSE&&(t(i.data),e.removeMessageListener("ActivityStream:MainToContent",n))})})}connect(){var e=this;return r(function*(){const t=yield e._openDB();yield e._restoreFromDb(t),e._db=t})()}_dbTransaction(e){return this._db?new Promise((t,n)=>{const s=e(this._db.transaction(c,"readwrite").objectStore(c));s.onsuccess=(e=>t()),s.onerror=(e=>n(s.error))}):Promise.resolve()}_openDB(){return new Promise((e,t)=>{const n=indexedDB.open(a,o);n.onerror=(e=>{indexedDB.deleteDatabase(a),t(e)}),n.onupgradeneeded=(e=>{const t=e.target.result;t.objectStoreNames.contains(c)||t.createObjectStore(c)}),n.onsuccess=(t=>{let n=t.target.result;n.onerror=(e=>console.error(e)),n.onversionchange=(e=>e.target.close()),e(n)})})}_restoreFromDb(e){return new Promise((t,n)=>{let s;try{s=e.transaction(c).objectStore(c).openCursor()}catch(e){return void n(e)}s.onerror=(e=>n(e)),s.onsuccess=(e=>{let n=e.target.result;n?("blockList"!==n.value&&this.set(n.key,n.value),n.continue()):t()})})}}class h{constructor(t){e.gSnippetsMap=new p(t),this._onAction=this._onAction.bind(this)}get snippetsMap(){return e.gSnippetsMap}_refreshSnippets(){var e=this;return r(function*(){e.snippetsMap.get("snippets-cached-version")!==e.appData.version&&e.snippetsMap.clear();const t=e.snippetsMap.get("snippets-last-update");if((!(t>=0)||Date.now()-t>l)&&e.appData.snippetsURL){e.snippetsMap.set("snippets-last-update",Date.now());try{const t=yield fetch(e.appData.snippetsURL);if(200===t.status){const n=yield t.text();e.snippetsMap.set("snippets",n),e.snippetsMap.set("snippets-cached-version",e.appData.version)}}catch(e){console.error(e)}}})()}_noSnippetFallback(){}_forceOnboardingVisibility(e){const t=document.getElementById("onboarding-notification-bar");t&&(t.style.display=e?"":"none")}_showRemoteSnippets(){const e=document.getElementById(this.elementId),t=this.snippetsMap.get("snippets");if(!e)throw new Error(`No element was found with id '${this.elementId}'.`);if(!t)throw new Error("No remote snippets were found in gSnippetsMap.");if("string"!=typeof t)throw new Error("Snippet payload was incorrectly formatted");e.innerHTML=t;for(const t of e.getElementsByTagName("script")){const e=document.createElement("script");e.text=t.text,t.parentNode.replaceChild(e,t)}}_onAction(e){e.data.type===s.c.SNIPPET_BLOCKED&&(this.snippetsMap.blockList.includes(e.data.data)||(this.snippetsMap.set("blockList",this.snippetsMap.blockList.concat(e.data.data)),document.getElementById("snippets-container").style.display="none"))}init(t){var n=this;return r(function*(){if(Object.assign(n,{appData:{},elementId:"snippets",connect:!0},t),e.addMessageListener&&e.addMessageListener("ActivityStream:MainToContent",n._onAction),n.connect)try{yield n.snippetsMap.connect()}catch(e){console.error(e)}for(const e of Object.keys(n.appData))"blockList"===e?n.snippetsMap.set("blockList",n.appData[e]):n.snippetsMap.set(`appData.${e}`,n.appData[e]);yield n._refreshSnippets();try{n._showRemoteSnippets()}catch(e){n._noSnippetFallback(e)}window.dispatchEvent(new Event(d)),n._forceOnboardingVisibility(!0),n.initialized=!0})()}uninit(){window.dispatchEvent(new Event(u)),this._forceOnboardingVisibility(!1),e.removeMessageListener&&e.removeMessageListener("ActivityStream:MainToContent",this._onAction),this.initialized=!1}}function m(e){const t=new h(e.dispatch),n=new i.a;let s=!1;return e.subscribe(r(function*(){const i=e.getState(),r=i.Prefs.values.asrouterExperimentEnabled&&i.Prefs.values.asrouterOnboardingCohort>0;!i.Prefs.values["feeds.snippets"]||r||i.Prefs.values.disableSnippets||!i.Snippets.initialized||t.initialized||s||"about:welcome"===location.href?!1!==i.Prefs.values["feeds.snippets"]&&!0!==i.Prefs.values.disableSnippets||!t.initialized||t.uninit():(s=!0,yield t.init({appData:i.Snippets}),s=!1),(i.Prefs.values.asrouterExperimentEnabled||i.Prefs.values.asrouterOnboardingCohort>0)&&i.Prefs.values["feeds.snippets"]&&!n.initialized?n.init():(i.Prefs.values.asrouterExperimentEnabled||0!==i.Prefs.values.asrouterOnboardingCohort)&&i.Prefs.values["feeds.snippets"]||!n.initialized||n.uninit()})),{snippets:t,asrouterContent:n}}}).call(this,n(5))},function(e,t,n){"use strict";n.r(t),function(e){var t=n(1),s=n(43),i=n(41),r=n(30),a=n(21),o=n(3),c=n(0),l=n.n(c),d=n(12),u=n.n(d),p=n(9);const h=Object(a.b)(p.b,e.gActivityStreamPrerenderedState);new r.a(h).sendEventOrAddListener(),e.gActivityStreamPrerenderedState||h.dispatch(t.b.AlsoToMain({type:t.c.NEW_TAB_STATE_REQUEST})),u.a.hydrate(l.a.createElement(o.Provider,{store:h},l.a.createElement(i.a,{isFirstrun:"about:welcome"===e.document.location.href,isPrerendered:!!e.gActivityStreamPrerenderedState,locale:e.document.documentElement.lang,strings:e.gActivityStreamStrings})),document.getElementById("root")),Object(s.a)(h)}.call(this,n(5))}]);
//# sourceMappingURL=activity-stream.bundle.js.map